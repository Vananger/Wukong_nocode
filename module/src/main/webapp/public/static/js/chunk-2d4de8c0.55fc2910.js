(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d4de8c0"],{1731:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-container",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"wk-print-container",class:{"is-perview":e.isPreview}},[i("el-header",[e.isPreview?[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleClick("download")}}},[e._v(e._s(e.perviewTypeName+" 下载"))]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleClick("print")}}},[e._v("打印")]),e._v(" "),i("el-button",{on:{click:function(t){e.handleClick("goback")}}},[e._v("取消")])]:[i("span",{staticClass:"select-label"},[e._v("选择模版")]),e._v(" "),i("el-select",{staticClass:"handle-item-content",staticStyle:{width:"170px"},on:{change:e.getDetail},model:{value:e.templateId,callback:function(t){e.templateId=t},expression:"templateId"}},e._l(e.templateOptions,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))),e._v(" "),i("span",{staticClass:"select-label"},[e._v("选择模版")]),e._v(" "),i("el-select",{staticClass:"handle-item-content",staticStyle:{width:"80px"},model:{value:e.perviewType,callback:function(t){e.perviewType=t},expression:"perviewType"}},e._l(e.previewOptions,(function(e){return i("el-option",{key:e,attrs:{label:e,value:e}})}))),e._v(" "),i("el-button",{staticClass:"preview-button",attrs:{type:"primary"},on:{click:e.printPreviewClick}},[e._v("打印预览")])]],2),e._v(" "),i("el-main",[i("div",{staticClass:"main-container"},[i("div",{staticClass:"main-content"},[i("iframe",{directives:[{name:"show",rawName:"v-show",value:e.isPreview,expression:"isPreview"}],staticStyle:{width:"100%","margin-top":"54px"},attrs:{id:"wkPrint",height:e.iframeHeight,src:e.iframeUrl,scrolling:"no",frameborder:"0"}})]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isPreview,expression:"!isPreview"}],staticClass:"main-tips"},[e._v("您可以在当前页面对模版文字进行调整，确认无误后可进行打印")]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isPreview,expression:"!isPreview"}],staticClass:"main-content"},[i("tinymce",{ref:"editor",staticClass:"rich-txt",attrs:{toolbar:[],init:{statusbar:!1,plugins:"print autoresize",extended_valid_elements:"span[class|title|wktag|style|contenteditable]",content_style:" body {padding: 60px !important;width: 595px; margin: 0 auto;} p { margin: 5px 0;}"}},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)])])],1)},a=[],o=(i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),i("9861"),i("2934")),s=i("871c"),r=i("8256"),c=i("ed08"),d={name:"Print",components:{Tinymce:r["a"]},props:{},data:function(){return{loading:!1,isPreview:!1,templateOptions:[],templateId:"",dataId:"",moduleId:"",version:"",previewOptions:["word","pdf"],perviewType:"word",content:"",historyData:null,currentPage:1,pageSize:10,iframeUrl:"",iframeHeight:document.documentElement.clientHeight-170,srcData:null}},computed:{perviewTypeName:function(){return{word:"Word",pdf:"PDF"}[this.perviewType]}},created:function(){"history"==this.$route.query.type?this.getRecordDetail():(this.dataId=this.$route.query.id,this.moduleId=this.$route.query.moduleId,this.version=this.$route.query.version,this.getTemplateOptions()),window.addEventListener("resize",this.changeIframeHeight)},beforeRouteUpdate:function(e,t,i){this.content="",i()},beforeDestroy:function(){window.removeEventListener("resize",this.changeIframeHeight)},methods:{changeIframeHeight:function(){this.iframeHeight=document.documentElement.clientHeight-170},getTemplateOptions:function(){var e=this;this.loading=!0,Object(s["l"])({moduleId:this.moduleId,version:this.version,page:this.currentPage,limit:this.pageSize}).then((function(t){e.templateOptions=t.data.list||[],"history"!=e.$route.query.type&&(e.templateOptions.length?(e.templateId=e.templateOptions[0].id,e.getDetail()):e.templateId=""),e.loading=!1})).catch((function(){e.loading=!1}))},getDetail:function(){var e=this;this.loading=!0,Object(s["i"])({templateId:this.templateId,dataId:this.dataId}).then((function(t){e.loading=!1,e.content=t.data})).catch((function(){e.loading=!1}))},getRecordDetail:function(){var e=this;this.loading=!0,Object(s["j"])({recordId:this.$route.query.recordId}).then((function(t){e.loading=!1;var i=t.data||{};e.historyData=i,e.templateId=i.templateId,e.dataId=i.dataId,e.moduleId=i.moduleId,e.version=i.version,e.getTemplateOptions(),e.content=i.recordContent||""})).catch((function(){e.loading=!1}))},compactPrint:function(){this.$refs.editor.editor.execCommand("mcePrint"),this.savePrintRecord()},printPreviewClick:function(){var e=this;this.loading=!0,Object(s["h"])({type:this.perviewType,content:this.content}).then((function(t){e.loading=!1;var i=t.data,n="/modulePrintTemplate/previewPdf?key=".concat(i);Object(o["i"])(n).then((function(t){e.iframeUrl=window.URL.createObjectURL(t.data)})).catch((function(){})),e.srcData=i,e.isPreview=!0})).catch((function(){e.loading=!1}))},savePrintRecord:function(){this.templateId&&this.dataId&&Object(s["k"])({templateId:this.templateId,moduleId:this.moduleId,dataId:this.dataId,recordContent:this.content}).then((function(e){})).catch((function(){}))},hidenView:function(){this.$emit("close")},handleClick:function(e){if("goback"==e)this.isPreview=!1;else if("print"==e)document.getElementById("wkPrint").contentWindow.print(),this.savePrintRecord();else if("download"==e&&this.srcData){var t=this.perviewType,i=this.srcData,n={key:i,type:"word"===t?2:1};t="word"===t?"doc":"pdf",Object(s["g"])(n).then((function(e){var i=new Blob([e.data],{type:""});Object(c["f"])(i,"文档.".concat(t))})).catch((function(){}))}}}},l=d,p=(i("82e5"),i("2877")),u=Object(p["a"])(l,n,a,!1,null,"537d9da0",null);t["default"]=u.exports},"82e5":function(e,t,i){"use strict";i("ad79")},ad79:function(e,t,i){}}]);