(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4dba786a"],{"3b89":function(e,t,a){"use strict";a("d520")},"464a":function(e,t,a){"use strict";a("47bf")},"47bf":function(e,t,a){},"4e82":function(e,t,a){"use strict";var i=a("23e7"),l=a("e330"),n=a("59ed"),o=a("7b0b"),r=a("07fa"),s=a("577e"),c=a("d039"),d=a("addb"),u=a("a640"),h=a("04d1"),v=a("d998"),f=a("2d00"),m=a("512ce"),p=[],b=l(p.sort),g=l(p.push),k=c((function(){p.sort(void 0)})),y=c((function(){p.sort(null)})),C=u("sort"),I=!c((function(){if(f)return f<70;if(!(h&&h>3)){if(v)return!0;if(m)return m<603;var e,t,a,i,l="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:a=3;break;case 68:case 71:a=4;break;default:a=2}for(i=0;i<47;i++)p.push({k:t+i,v:a})}for(p.sort((function(e,t){return t.v-e.v})),i=0;i<p.length;i++)t=p[i].k.charAt(0),l.charAt(l.length-1)!==t&&(l+=t);return"DGBEFHACIJK"!==l}})),_=k||!y||!C||!I,w=function(e){return function(t,a){return void 0===a?-1:void 0===t?1:void 0!==e?+e(t,a)||0:s(t)>s(a)?1:-1}};i({target:"Array",proto:!0,forced:_},{sort:function(e){void 0!==e&&n(e);var t=o(this);if(I)return void 0===e?b(t):b(t,e);var a,i,l=[],s=r(t);for(i=0;i<s;i++)i in t&&g(l,t[i]);d(l,w(e)),a=l.length,i=0;while(i<a)t[i]=l[i++];while(i<s)delete t[i++];return t}})},d520:function(e,t,a){},e365:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"role-authorization main"},[a("xr-header",{ref:"xrHeader",attrs:{label:"角色权限控制"}}),e._v(" "),a("flexbox",{staticClass:"search-bar",attrs:{justify:"space-between"}},[a("el-input",{staticClass:"search-input",attrs:{placeholder:"请输入内容"},on:{blur:e.refreshUserList},nativeOn:{keyup:function(t){return!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.refreshUserList(t)}},model:{value:e.searchInput,callback:function(t){e.searchInput=t},expression:"searchInput"}},[a("el-button",{attrs:{slot:"suffix",type:"icon",icon:"wk wk-sousuo"},nativeOn:{click:function(t){return e.refreshUserList(t)}},slot:"suffix"})],1)],1),e._v(" "),a("div",{staticClass:"main-content-wrap is-tabs"},[a("div",{staticClass:"main-nav"},[a("div",{staticClass:"main-nav__title"},[e._v("\n        "+e._s(e.title)+"\n        "),a("el-button",{staticClass:"add-btn",attrs:{type:"text"},on:{click:function(t){e.roleEditClick()}}},[e._v("创建角色")])],1),e._v(" "),e.roleList.length>0?a("div",{staticClass:"nav-sections-wrap"},[a("div",{staticClass:"nav-section"},e._l(e.roleList,(function(t,i){return a("div",{key:i,staticClass:"menu-item",class:{"is-select":e.activeRole&&t.roleId===e.activeRole.roleId},on:{click:function(a){e.roleSelect(t)}}},[a("div",{staticClass:"menu-item__content"},[e._v(e._s(t.roleName))]),e._v(" "),a("div",{staticClass:"icon-close"},[a("el-dropdown",{attrs:{trigger:"click"},on:{command:e.roleHandleClick}},[a("i",{staticClass:"el-icon-arrow-down"}),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"copy"}},[e._v("复制")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"edit"}},[e._v("编辑")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除")])],1)],1)],1)])})))]):a("flexbox",{staticClass:"empty-role",attrs:{direction:"column"}},[e._v("\n        暂无可用角色\n      ")])],1),e._v(" "),a("div",{staticClass:"main-content"},[a("el-tabs",{model:{value:e.mainMenuIndex,callback:function(t){e.mainMenuIndex=t},expression:"mainMenuIndex"}},[a("el-tab-pane",{attrs:{label:"角色员工",name:"user"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.userLoading,expression:"userLoading"}],staticClass:"content-table"},[a("flexbox",{staticClass:"content-table-header"},[a("div",{staticClass:"content-table-header-reminder"}),e._v(" "),a("el-button",{attrs:{disabled:0===e.roleList.length},on:{click:function(t){e.relateEmployeeShow=!e.relateEmployeeShow}}},[e._v("关联员工")])],1),e._v(" "),e.showTable?a("el-table",{ref:"elTable",staticStyle:{width:"100%"},style:{height:e.tableHeight+"px"},attrs:{data:e.tableData,height:e.tableHeight}},[a("el-table-column",{attrs:{prop:"realname",width:"150","show-overflow-tooltip":"",label:"姓名"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",{staticClass:"status-name"},[0===i.userIdentity?a("span",{staticClass:"main-mark"},[e._v("主账号")]):e._e(),e._v(" "),a("span",[e._v(e._s(e.$getUserName(i)))])])]}}])}),e._v(" "),e._l(e.tableFieldList,(function(e,t){return a("el-table-column",{key:t,attrs:{prop:e.field,label:e.label,"show-overflow-tooltip":""}})})),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"wk wk-delete table-edit-btn",attrs:{disabled:0===t.row.userIdentity,type:"text",title:"删除"},on:{click:function(a){e.employeeHandleClick("delete",t.row)}}})]}}])})],2):e._e()],1)]),e._v(" "),a("el-tab-pane",{attrs:{label:"角色权限",name:"rule"}},[a("div",{staticClass:"jurisdiction-box"},[e.activeRole?a("el-button",{staticClass:"jurisdiction-edit",attrs:{disabled:0===e.roleList.length,size:"medium",type:"primary"},on:{click:e.ruleSubmit}},[e._v(" 保存 ")]):e._e(),e._v(" "),a("el-tabs",{on:{change:e.changeAuthTab},model:{value:e.ruleMenuIndex,callback:function(t){e.ruleMenuIndex=t},expression:"ruleMenuIndex"}},[a("el-tab-pane",{attrs:{label:"模块功能",name:"tree"}},[a("div",{staticClass:"jurisdiction-content",style:{height:e.treeHeight+"px"}},[a("div",{staticClass:"jurisdiction-content-checkbox"},[e.activeRole&&e.roleAuthTree.length?a("el-tree",{ref:"tree",staticStyle:{height:"0"},attrs:{data:e.roleAuthTree,indent:0,"expand-on-click-node":!1,props:e.defaultProps,"show-checkbox":"","node-key":"value","empty-text":"","default-expand-all":""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node;return a("span",{class:{"node-label":1===i.level||2===i.level}},[e._v("\n                        "+e._s(i.label)+"\n                        "),2===i.level?a("el-button",{attrs:{icon:"wk wk-manage",type:"text"},on:{click:function(t){e.fieldSetClick(i)}}},[e._v("字段授权")]):e._e()],1)}}])}):e._e()],1)])]),e._v(" "),a("el-tab-pane",{attrs:{label:"数据权限",name:"data"}},[a("div",{staticClass:"data-radio"},[a("el-radio-group",{model:{value:e.roleRangeType,callback:function(t){e.roleRangeType=t},expression:"roleRangeType"}},[a("el-radio",{attrs:{label:1}},[e._v("本人")]),e._v(" "),a("el-radio",{attrs:{label:2}},[e._v("本人及下属")]),e._v(" "),a("el-radio",{attrs:{label:3}},[e._v("本部门")]),e._v(" "),a("el-radio",{attrs:{label:4}},[e._v("本部门及下属部门")]),e._v(" "),a("el-radio",{attrs:{label:5}},[e._v("全部")])],1)],1)])],1)],1)])],1)],1)]),e._v(" "),a("el-dialog",{attrs:{title:e.roleDialogTitle,visible:e.roleDialogVisible,"before-close":e.roleClose,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.roleDialogVisible=t}}},[a("label",{staticClass:"label-title"},[e._v("角色名称")]),e._v(" "),a("el-input",{staticClass:"input-role",attrs:{maxlength:100},model:{value:e.roleForm.roleName,callback:function(t){e.$set(e.roleForm,"roleName","string"===typeof t?t.trim():t)},expression:"roleForm.roleName"}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.roleSubmit}},[e._v("确 定")]),e._v(" "),a("el-button",{on:{click:e.roleClose}},[e._v("\n        取 消\n      ")])],1)],1),e._v(" "),e.activeRole?a("relate-employee",{attrs:{visible:e.relateEmployeeShow,"role-id":e.activeRole.roleId,prevent:""},on:{"update:visible":function(t){e.relateEmployeeShow=t},save:e.saveRoleUser}}):e._e(),e._v(" "),e.editRoleDialogShow?a("edit-role-dialog",{attrs:{"user-show":"copy"===e.editRoleType,"selection-list":e.selectionList,visible:e.editRoleDialogShow},on:{"update:visible":function(t){e.editRoleDialogShow=t},change:e.getRoleList}}):e._e(),e._v(" "),e.setFieldShow?a("custom-field-set-dialog",{attrs:{visible:e.setFieldShow,"role-id":e.activeRole.roleId,"module-id":e.setFieldModuleId,"category-id":e.setFieldCategoryId,"module-name":e.setFieldModuleName,"app-id":e.appId},on:{"update:visible":function(t){e.setFieldShow=t}}}):e._e()],1)},l=[],n=a("3835"),o=a("2909"),r=a("1da1"),s=a("5530"),c=(a("96cf"),a("7db0"),a("d3b7"),a("4de4"),a("d81d"),a("159b"),a("a15b"),a("99af"),a("a630"),a("3ca3"),a("6062"),a("ddb0"),a("4e82"),a("b0c0"),a("ac1f"),a("1276"),a("4ec9"),a("563d")),d=a("8950"),u=a("f468"),h=a("4dd8"),v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.visible,"append-to-body":!0,"close-on-click-modal":!1,title:e.title,width:"700px"},on:{close:e.handleCancel}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"field-set-dialog"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.list,height:"50vh",border:""}},[a("el-table-column",{attrs:{label:"字段名称",prop:"name",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{label:"字段权限"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("el-checkbox",{attrs:{disabled:!e.getCanOpreateRead(i.operateType)},on:{change:function(t){e.checkCheckboxChange(i)}},model:{value:i.canCheck,callback:function(t){e.$set(i,"canCheck",t)},expression:"row.canCheck"}},[e._v("可以查看")]),e._v(" "),a("el-checkbox",{attrs:{disabled:!e.getCanOpreateEdit(i.operateType)},on:{change:function(t){e.editCheckboxChange(i)}},model:{value:i.canEdit,callback:function(t){e.$set(i,"canEdit",t)},expression:"row.canEdit"}},[e._v("可以修改")]),e._v(" "),e.getMaskIsShow(i)?[a("el-checkbox",{on:{change:function(t){e.maskCheckboxChange(i)}},model:{value:i.canMask,callback:function(t){e.$set(i,"canMask",t)},expression:"row.canMask"}},[e._v("掩码显示")]),e._v(" "),a("el-button",{staticClass:"mask-button",attrs:{disabled:!i.canMask,type:"text"},on:{click:function(t){e.setMaskClick(i)}}},[e._v("设置掩码规则")])]:e._e()]}}])})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{float:"left"},attrs:{type:"text"},on:{click:e.getFieldList}},[e._v("重置")]),e._v(" "),a("el-button",{on:{click:e.handleCancel}},[e._v("取消")]),e._v(" "),a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("保存")])],1),e._v(" "),e.maskSetVisible?a("el-dialog",{attrs:{visible:e.maskSetVisible,"append-to-body":!0,"close-on-click-modal":!1,title:"设置掩码规则",width:"500px"},on:{close:function(t){e.maskSetVisible=!1}}},[a("div",{staticClass:"mask-wrap"},[a("div",{staticClass:"mask-wrap__des"},[e._v("\n        1、勾选该选项后，该字段的值在页面上将以掩码显示，比如 ：手机188****8888、邮箱wa*****@5kcrm.com、货币全部掩码显示、地址的详细地址全部掩码显示"),a("br"),e._v("\n        2、字段配置掩码后，若用户看到的是掩码显示，那该用户导出的也是掩码显示"),a("br"),e._v("\n        3、编辑页面为非掩码显示\n      ")]),e._v(" "),a("div",{staticClass:"mask-wrap__body"},[a("div",[e._v("掩码显示的页面")]),e._v(" "),a("div",{staticClass:"handle"},[a("el-checkbox",{attrs:{disabled:""},model:{value:e.maskEditDetail.tableMask,callback:function(t){e.$set(e.maskEditDetail,"tableMask",t)},expression:"maskEditDetail.tableMask"}},[e._v("列表页面")]),e._v(" "),a("el-checkbox",{model:{value:e.maskEditDetail.viewMask,callback:function(t){e.$set(e.maskEditDetail,"viewMask",t)},expression:"maskEditDetail.viewMask"}},[e._v("详情页面")])],1)])]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.maskSetVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleMaskConfirm,expression:"handleMaskConfirm"}],attrs:{type:"primary"}},[e._v("确定")])],1)]):e._e()],1)},f=[],m=(a("a9e3"),a("caad"),a("ed08")),p=a("3f26"),b={name:"CustomFieldSetDialog",components:{},mixins:[],props:{appId:[String,Number],moduleId:[String,Number],categoryId:[String,Number],roleId:[String,Number],visible:{type:Boolean,required:!0,default:!1}},data:function(){return{loading:!1,list:[],rowDetail:null,maskEditDetail:null,maskSetVisible:!1}},computed:{title:function(){return"字段授权"}},watch:{visible:{handler:function(){this.visible&&this.getFieldList()},immediate:!0}},mounted:function(){},methods:{getFieldList:function(){var e=this;this.list=[],this.loading=!0,Object(c["g"])({applicationId:this.appId,moduleId:this.moduleId,categoryId:this.categoryId,roleId:this.roleId}).then((function(t){e.loading=!1;var a=t.data.fields||[];a=Object(p["a"])(a,{filterSys:!1,excludesFieldName:!0}),a=a.sort((function(e,t){return e.fieldType>t.fieldType?-1:1})),a.forEach((function(e){e.canCheck=2===e.authLevel||3===e.authLevel,e.canEdit=3===e.authLevel,e.canMask=0!==e.maskType,e.tableMask=1===e.maskType||2===e.maskType,e.viewMask=2===e.maskType})),e.list=a})).catch((function(){e.loading=!1}))},handleCancel:function(){this.$emit("update:visible",!1)},getCanOpreateRead:function(e){return 1==e||2==e},getCanOpreateEdit:function(e){return 1==e||3==e},getMaskIsShow:function(e){var t=e.type;return[7,14,6,43].includes(t)},handleConfirm:function(){var e=this;this.loading=!0;var t=Object(m["t"])(this.list);t.forEach((function(e){var t=3;t=e.canCheck&&e.canEdit?3:e.canCheck?2:1,e.authLevel=t,delete e.canCheck,delete e.canEdit;var a=0;(e.tableMask||e.viewMask)&&(a=e.tableMask&&e.viewMask?2:1),e.maskType=a,delete e.canMask,delete e.tableMask,delete e.viewMask})),Object(c["h"])({roleId:this.roleId,moduleId:this.moduleId,categoryId:this.categoryId,roleFieldList:t}).then((function(t){e.loading=!1,e.$message.success("操作成功"),e.handleCancel()})).catch((function(){e.loading=!1}))},editCheckboxChange:function(e){e.canEdit&&this.$set(e,"canCheck",!0)},checkCheckboxChange:function(e){!e.canCheck&&e.canEdit&&this.$set(e,"canEdit",!1)},maskCheckboxChange:function(e){e.tableMask=e.canMask,e.viewMask=e.canMask},setMaskClick:function(e){this.rowDetail=e,this.maskEditDetail=Object(m["t"])(e),this.maskSetVisible=!0},handleMaskConfirm:function(){this.rowDetail.tableMask=this.maskEditDetail.tableMask,this.rowDetail.viewMask=this.maskEditDetail.viewMask,this.maskSetVisible=!1}}},g=b,k=(a("3b89"),a("2877")),y=Object(k["a"])(g,v,f,!1,null,"005ad669",null),C=y.exports,I=a("2f62"),_=a("8d55"),w={name:"CustomAuth",components:{XrHeader:u["a"],RelateEmployee:d["a"],EditRoleDialog:h["a"],CustomFieldSetDialog:C},data:function(){return{appId:null,title:"",loading:!1,userLoading:!1,searchInput:"",roleList:[],activeRole:null,mainMenuIndex:"user",ruleMenuIndex:"tree",showTable:!0,tableHeight:document.documentElement.clientHeight-330,tableData:[],tableFieldList:[{label:"部门",field:"deptName"},{label:"职位",field:"post"},{label:"角色",field:"roleName"}],currentPage:1,pageSize:15,pageSizes:[15,30,45,60],total:0,roleDialogTitle:"",roleDialogVisible:!1,roleForm:{},editRoleDialogShow:!1,selectionList:[],editRoleType:"",roleRangeType:1,relateEmployeeShow:!1,defaultProps:{children:"children",label:"label",disabled:!1},roleAuthTree:[],treeHeight:document.documentElement.clientHeight-230,setFieldLabel:"",setFieldShow:!1,setFieldModuleId:null,setFieldCategoryId:null,setFieldModuleName:null}},computed:Object(s["a"])({},Object(I["c"])("appModule",["userAppDataList","userAppCategoryList"])),watch:{$route:{handler:function(){this.appId=this.$route.params.appId,this.title=this.$route.params.title,this.getRoleList()},deep:!0}},mounted:function(){var e=this;window.onresize=function(){e.tableHeight=document.documentElement.clientHeight-330,e.treeHeight=document.documentElement.clientHeight-230,e.showTable=!1,e.$nextTick((function(){e.showTable=!0}))},this.appId=this.$route.params.appId,this.title=this.$route.params.title,this.getRoleList()},methods:Object(s["a"])(Object(s["a"])({},Object(I["b"])({getActiveModuleByAppId:"appModule/getActiveModuleByAppId"})),{},{getRoleList:function(){var e=this;this.loading=!0,Object(c["i"])(this.appId).then((function(t){if(e.loading=!1,e.roleList=t.data||[],e.activeRole){var a=e.roleList.find((function(t){return t.roleId===e.activeRole.roleId}));a?e.roleSelect(a):e.roleSelect(e.roleList[0]||null)}else e.roleSelect(e.roleList[0]||null)})).catch((function(){e.loading=!1}))},roleSelect:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,l,n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e){a.next=6;break}return t.activeRole=null,t.roleRangeType=null,t.roleAuthTree=[],t.tableData=[],a.abrupt("return");case 6:return t.activeRole=e,t.roleRangeType=e.rangeType,i=Object(m["t"])(e.roleUserList||[]).filter((function(e){return-1!==t.$getUserName(e).indexOf(t.searchInput)})),l=i.map((function(e){return e.userId})),a.next=12,t.getUserAdminRole(l);case 12:return n=a.sent,a.next=15,t.getUserCustomRole(l);case 15:return r=a.sent,i.forEach((function(e){var t=(n[e.userId]||[]).filter((function(e){return!!e})).map((function(e){return e.roleName})),a=(r[e.userId]||[]).filter((function(e){return!!e})).map((function(e){return e.roleName}));e.roleName=[].concat(Object(o["a"])(t),Object(o["a"])(a)).join(",")})),t.tableData=i,t.handleCurrentChange(1),a.next=22,t.renderTree().catch((function(){return[]}));case 22:t.roleAuthTree=a.sent,t.renderCheckedNode();case 24:case"end":return a.stop()}}),a)})))()},getUserCustomRole:function(e){return new Promise((function(t,a){if(!e||!e.length)return t({});Object(c["k"])(e).then((function(e){t(e.data||{})})).catch((function(){a()}))}))},getUserAdminRole:function(e){return new Promise((function(t,a){if(!e||!e.length)return t({});Object(_["a"])(e).then((function(e){t(e.data||{})})).catch((function(){a()}))}))},roleHandleClick:function(e){switch(e){case"edit":this.roleEditClick(this.activeRole);break;case"copy":this.roleCopyClick(this.activeRole);break;case"delete":this.roleDeleteClick(this.activeRole)}},roleEditClick:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?(this.roleForm={roleId:e.roleId,roleName:e.roleName},this.roleDialogTitle="编辑角色"):(this.roleForm={roleName:""},this.roleDialogTitle="新建角色"),this.roleDialogVisible=!0},roleCopyClick:function(e){var t=Object(m["t"])(e),a=["roleId","companyId","createTime","createUserId","roleModuleList","roleUserList"];a.forEach((function(e){delete t[e]})),t.roleName+="_copy",this.updateRole(t)},roleDeleteClick:function(e){var t=this;this.$confirm("此操作将永久删除是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,Object(c["f"])(e.roleId).then((function(){t.roleSelect(null),t.getRoleList(),t.$message.success("删除成功")})).catch((function(){t.loading=!1}))})).catch((function(){t.$message.info("已取消删除")}))},roleSubmit:function(){this.roleForm.roleName?this.updateRole(this.roleForm):this.$message.error("角色名称不能为空！")},updateRole:function(e){var t=this;this.loading=!0,Object(c["j"])(Object(s["a"])({applicationId:this.appId},e)).then((function(a){t.loading=!1,t.$message.success(e.roleId?"编辑成功":"添加成功"),t.roleClose(),t.getRoleList()})).catch((function(){t.loading=!1}))},roleClose:function(){this.roleDialogVisible=!1,this.roleForm={}},saveRoleUser:function(e){var t=(this.activeRole.roleUserList||[]).map((function(e){return e.userId})),a=Array.from(new Set([].concat(Object(o["a"])(e),Object(o["a"])(t))));this.employeesSave(a)},employeesSave:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"保存成功";this.loading=!0,Object(c["m"])({applicationId:this.appId,roleId:this.activeRole.roleId,userIds:e}).then((function(){t.$message.success(a),t.relateEmployeeShow=!1,t.loading=!1,t.userLoading=!1,t.refreshUserList()})).catch((function(){t.loading=!1}))},employeeHandleClick:function(e,t){var a=this;"delete"===e&&this.$confirm("此操作将永久删除是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.userLoading=!0;var e=(a.activeRole.roleUserList||[]).map((function(e){return e.userId})).filter((function(e){return e!==t.userId}));a.employeesSave(e,"删除成功")})).catch((function(){a.$message({type:"info",message:"已取消删除"})}))},handleSizeChange:function(e){this.pageSize=e,this.refreshUserList()},handleCurrentChange:function(e){this.currentPage=e,this.getUserList()},getUserList:function(){},refreshUserList:function(){this.getRoleList()},changeAuthTab:function(){"true"===this.ruleMenuIndex&&this.renderCheckedNode()},getCategories:function(e){var t=[];return this.userAppCategoryList.filter((function(t){return t.moduleId===e.moduleId&&t.version===e.version})).sort((function(e,t){return e.sort-t.sort})).forEach((function(a){t.push(Object(s["a"])(Object(s["a"])({},e),{},{categoryId:a.categoryId,categoryName:a.categoryName,categoryType:a.type}))})),0===t.length&&t.push(e),t},renderTree:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,i,l,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=[{moduleId:null,label:"全部",value:"all",children:[]}],i=[],l=[{label:"查看列表",value:"index",auth:1},{label:"查看详情",value:"read",auth:2},{label:"新建",value:"save",auth:3},{label:"编辑",value:"edit",auth:4},{label:"转移",value:"transfer",auth:5},{label:"删除",value:"delete",auth:6},{label:"导入",value:"import",auth:7},{label:"导出",value:"export",auth:8},{label:"打印",value:"print",auth:9},{label:"转移到分类",value:"moveCategory",auth:10},{label:"编辑团队成员",value:"teamSave",auth:11}],n=e.userAppDataList.find((function(t){return t.applicationId===e.appId})),!n){t.next=9;break}if(n.activeModule&&n.activeModule.length){t.next=8;break}return t.next=8,e.getActiveModuleByAppId(n.applicationId);case 8:n.activeModule.forEach((function(t){var a=e.getCategories(t);a.forEach((function(e){var a=e.categoryType?e.categoryId:"";i.push({label:e.categoryType?e.categoryName:e.name,value:"".concat(e.moduleId,"-").concat(a),moduleId:e.moduleId,name:e.name,categoryId:e.categoryId,categoryType:e.categoryType,categoryName:e.categoryName,children:l.map((function(i){return Object(s["a"])(Object(s["a"])({},i),{},{name:e.name,moduleId:t.moduleId,categoryId:e.categoryId,categoryType:e.categoryType,categoryName:e.categoryName,value:"".concat(t.moduleId,"-").concat(a,"-").concat(i.auth)})}))})}))}));case 9:return a[0].children=i,t.abrupt("return",a);case 12:case"end":return t.stop()}}),t)})))()},renderCheckedNode:function(){var e=this,t=[],a=this.activeRole.roleModuleList||[];a.forEach((function(e){(e.auth||"").split(",").filter((function(e){return e})).forEach((function(a){t.push("".concat(e.moduleId,"-").concat(e.categoryId||"","-").concat(a))}))})),this.$nextTick((function(){var a=e.$refs.tree;a&&a.setCheckedKeys(t)}))},ruleSubmit:function(){var e=this,t=[],a=this.$refs.tree;if(a){var i=a.getCheckedNodes(),l=new Map,n=i.filter((function(e){var t="".concat(e.moduleId,"-").concat(e.categoryId||"");return!l.has(t)&&l.set(t,1)}));n.forEach((function(e){var a=i.filter((function(t){return t.moduleId===e.moduleId&&t.categoryId===e.categoryId&&!t.children})),l={moduleId:e.moduleId,name:e.name,auth:a.map((function(e){return e.auth})).join(",")};e.categoryId&&e.categoryType&&(l.categoryId=e.categoryId,l.categoryName=e.categoryName),t.push(l)}))}else t=this.activeRole.roleModuleList||[];this.loading=!0;var o=[Object(c["e"])({roleId:this.activeRole.roleId,roleModules:t})];this.activeRole.rangeType!==this.roleRangeType&&o.push(Object(c["j"])({applicationId:this.appId,roleId:this.activeRole.roleId,roleName:this.activeRole.roleName,rangeType:this.roleRangeType})),Promise.all(o).then((function(){e.$message.success("保存成功"),e.loading=!1,e.getRoleList()})).catch((function(){e.loading=!1}))},fieldSetClick:function(e){var t=e.data.value.split("-").filter((function(e){return!!e})),a=Object(n["a"])(t,2),i=a[0],l=a[1],o=void 0===l?null:l;this.setFieldModuleId=i,this.setFieldCategoryId=o,this.setFieldModuleName=e.data.label,this.setFieldShow=!0}})},x=w,M=(a("464a"),Object(k["a"])(x,i,l,!1,null,"ef0e023c",null));t["default"]=M.exports}}]);