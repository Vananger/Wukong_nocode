(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d5eff438"],{"4dd8":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{ref:"wkDialog",attrs:{visible:e.visible,"append-to-body":!0,"close-on-click-modal":!1,width:"500px"},on:{close:e.close}},[n("div",{staticClass:"el-dialog__title",attrs:{slot:"title"},slot:"title"},[e._v("\n    "+e._s(e.title)),e.userShow?n("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[n("div",{attrs:{slot:"content"},slot:"content"},[e._v("1、可以将员工角色复制给其他员工。"),n("br"),e._v("\n        2、若选择的员工已有角色，原角色会被覆盖。"),n("br"),e._v("\n        3、若选择部门，该部门所有员工的角色将相同，可保存后再对员工独立调整。\n      ")]),e._v(" "),n("i",{staticClass:"wk wk-help wk-help-tips",staticStyle:{"margin-left":"3px"}})]):e._e()],1),e._v(" "),n("el-form",{ref:"editRoleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px","label-position":"top"}},[e.userShow?n("el-form-item",{attrs:{label:"选择员工和部门",prop:"userIds"}},[n("wk-user-dep-dialog-select",{staticStyle:{width:"100%"},attrs:{"user-value":e.ruleForm.userIds,"dep-value":e.ruleForm.deptIds},on:{"update:userValue":function(t){e.$set(e.ruleForm,"userIds",t)},"update:depValue":function(t){e.$set(e.ruleForm,"deptIds",t)}}})],1):e._e(),e._v(" "),n("el-form-item",{attrs:{label:"设置角色",prop:"roleList"}},[n("role-employee-select",{staticStyle:{width:"100%"},attrs:{props:e.roleSelectProps,multiple:""},model:{value:e.ruleForm.roleList,callback:function(t){e.$set(e.ruleForm,"roleList",t)},expression:"ruleForm.roleList"}})],1)],1),e._v(" "),n("div",{}),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:e.sureClick}},[e._v("确定")]),e._v(" "),n("el-button",{on:{click:e.close}},[e._v("取消")])],1)],1)},s=[],r=n("5530"),o=(n("ac1f"),n("1276"),n("d3b7"),n("159b"),n("caad"),n("2532"),n("99af"),n("a630"),n("3ca3"),n("6062"),n("ddb0"),n("d81d"),n("7db0"),n("8d55")),i=n("612a"),l=n("563d"),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-select",e._g(e._b({ref:"select",staticClass:"role-employee-select",on:{"visible-change":e.selectVisibleChange,change:e.selectChange},model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}},"el-select",e.$attrs,!1),e.$listeners),[n("div",{staticClass:"role-employee-select__body"},[n("el-tabs",{ref:"roleTabs",class:{"el-tabs__header--hidden":e.config.onlyShowRole},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{ref:"roleTabPane",attrs:{label:"自选角色",name:"role"}},e._l(e.roleOption,(function(t){return n("div",{key:t.parentId,attrs:{label:t.name}},[n("div",{staticClass:"role-employee-select__title"},[e._v(e._s(t.name))]),e._v(" "),e._l(t.list,(function(e){return n("el-option",{key:e.roleId,staticStyle:{padding:"0 10px"},attrs:{label:e.roleName,value:e.roleId}})}))],2)}))),e._v(" "),n("el-tab-pane",{attrs:{label:"按员工复制角色",name:"employee"}},[n("el-input",{staticClass:"search-input",attrs:{placeholder:"搜索成员",size:"small","prefix-icon":"el-icon-search"},on:{input:e.userSearch},model:{value:e.searchInput,callback:function(t){e.searchInput=t},expression:"searchInput"}}),e._v(" "),e._l(e.userOption,(function(t){return n("el-option",{directives:[{name:"show",rawName:"v-show",value:!t.isHide,expression:"!item.isHide"}],key:t.userId,staticStyle:{padding:"0 10px"},attrs:{label:e.$getUserName(t),value:t.userId+"@"+t.roleId}},[n("flexbox",{staticClass:"cell"},[n("xr-avatar",{staticClass:"cell__img",attrs:{name:e.$getUserName(t),size:24,src:e.$getUserImg(t)}}),e._v(" "),n("div",{staticClass:"cell__body"},[n("wx-open-data",{attrs:{openid:e.$getUserName(t)}})],1),e._v(" "),n("el-tooltip",{attrs:{content:t.roleName,effect:"dark",placement:"top"}},[n("div",{staticClass:"cell__footer text-one-line"},[e._v(e._s(t.roleName))])])],1)],1)}))],2)],1)],1)])},u=[],d=n("2909"),p=n("1da1"),h=(n("96cf"),n("a9e3"),n("4de4"),n("b0c0"),n("b64b"),n("a15b"),n("466d"),n("2934")),f=n("8122"),m=n("a318"),b=n.n(m),v=n("8ed6"),g=n("2f62"),y={onlyShowRole:!1,roleRequest:null,showCustomRoles:!1},_={name:"RoleEmployeeSelect",components:{},props:{props:{type:Object,default:function(){return{}}},value:[Array,Number,String]},data:function(){return{selectValue:[],activeName:"",roleOption:[],userOption:[],searchInput:""}},computed:Object(r["a"])(Object(r["a"])({},Object(g["c"])(["moduleAuth"])),{},{config:function(){return Object(v["a"])(Object(r["a"])({},y),this.props||{})},select:function(){return this.$refs.select}}),watch:{value:{handler:function(){Object(f["valueEquals"])(this.value,this.selectValue)||(this.selectValue=this.value)},immediate:!0}},created:function(){this.getRoleList(),this.getUserList()},mounted:function(){},beforeDestroy:function(){},methods:{selectVisibleChange:function(e){""!==this.activeName&&"0"!==this.activeName||(this.activeName="role")},getRoleList:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){var n,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.config.roleRequest||i["d"],t.next=3,n().then((function(e){return e.data||[]})).catch((function(){return[]}));case 3:if(a=t.sent,s=!!e.config.showCustomRoles&&e.moduleAuth&&e.moduleAuth.customApp,s){t.next=8;break}return e.roleOption=a,t.abrupt("return");case 8:Object(l["c"])().then((function(t){var n=(t.data||[]).filter((function(e){return e.roles.length>0})).map((function(e){return{parentId:e.applicationId,applicationId:e.applicationId,name:e.name+"（自定义应用）",list:e.roles.map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{roleId:"".concat(e.applicationId,"-").concat(e.roleId)})}))}}));e.roleOption=[].concat(Object(d["a"])(a),Object(d["a"])(n))})).catch((function(){}));case 9:case"end":return t.stop()}}),t)})))()},getUserList:function(){var e=this,t=!!this.config.showCustomRoles&&this.moduleAuth&&this.moduleAuth.customApp;Object(h["p"])({pageType:0}).then(function(){var n=Object(p["a"])(regeneratorRuntime.mark((function n(a){var s,r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(s=a.data.list||[],!t){n.next=7;break}return r=s.map((function(e){return e.userId})),n.next=5,e.getUserCustomRole(r).catch((function(){return{}}));case 5:o=n.sent,Object.keys(o).forEach((function(e){var t=s.find((function(t){return t.userId===e}));if(t){var n=o[e].map((function(e){return e.roleName})),a=o[e].map((function(e){return"".concat(e.applicationId,"-").concat(e.roleId)}));t.roleName=[t.roleName].concat(Object(d["a"])(n)).join(","),t.roleId=[t.roleId].concat(Object(d["a"])(a)).join(",")}}));case 7:e.userOption=s;case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch((function(){}))},getUserCustomRole:function(e){return new Promise((function(t,n){if(!e||!e.length)return t({});Object(l["k"])(e).then((function(e){t(e.data||{})})).catch((function(){n()}))}))},selectChange:function(){this.$emit("input",this.selectValue)},userSearch:function(){var e=this;this.userOption.forEach((function(t){t.isHide=!b.a.match(e.$getUserName(t),e.searchInput)}))}}},O=_,j=(n("ffd0"),n("f98a"),n("2877")),C=Object(j["a"])(O,c,u,!1,null,"2fc4ee82",null),w=C.exports,k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("wk-tags-view",{staticClass:"wk-user-dep-dialog-select",attrs:{selected:e.selected,visible:e.visible,disabled:e.disabled,placeholder:e.placeholder,"collapse-tags":e.collapseTags,"wx-type-name":"userName","value-key":["nickname","realname","name"],"no-border":e.noBorder},on:{"remove-tag":e.removeTag},nativeOn:{click:function(t){return e.click(t)}}},[n("wk-dep-user-dialog",e._b({ref:"depUserDialog",attrs:{"user-value":e.selectUserValue,"dep-value":e.selectDepValue,props:e.props,visible:e.visible,radio:e.radio,disabled:e.disabled},on:{"update:visible":function(t){e.visible=t},change:e.depUserDialogChange}},"wk-dep-user-dialog",e.$attrs,!1))],1)},I=[],x=(n("a434"),n("2581")),R=n("58fa"),U=n("d010"),F=n.n(U),S=n("ed08"),V={value:"deptId",label:"name"},D={name:"WkUserDepDialogSelect",components:{WkDepUserDialog:x["a"],WkTagsView:R["a"]},mixins:[F.a],props:{radio:Boolean,userValue:{type:Array,default:function(){return[]}},depValue:{type:Array,default:function(){return[]}},placeholder:{type:String,default:function(){return"请选择"}},collapseTags:Boolean,disabled:{type:Boolean,default:!1},props:{type:Object,default:function(){return{showDisableUser:!1}}},noBorder:{type:Boolean,default:!1}},data:function(){return{visible:!1,selectUserValue:[],selectDepValue:[],dataValue:[]}},computed:Object(r["a"])(Object(r["a"])({},Object(g["c"])(["userDeptMap"])),{},{userSelectData:function(){var e=this,t=[];return this.selectUserValue.forEach((function(n){var a=e.userDeptMap["user-".concat(n)];a&&t.push(a)})),t},deptSelectData:function(){var e=this,t=[];return this.selectDepValue.forEach((function(n){var a=e.userDeptMap["dept-".concat(n)];a&&t.push(a)})),t},selected:function(){return this.userSelectData.concat(this.deptSelectData)},config:function(){return Object(v["a"])(Object(r["a"])({},V),this.props||{})}}),watch:{userValue:{handler:function(){this.selectUserValue=Object(S["t"])(this.userValue)},immediate:!0},depValue:{handler:function(){this.selectDepValue=Object(S["t"])(this.depValue)},immediate:!0}},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{removeTag:function(e){e<this.selectUserValue.length?this.selectUserValue.splice(e,1):this.selectDepValue.splice(e-this.selectUserValue.length,1),this.depUserDialogChange(this.selectUserValue,this.selectDepValue)},depUserDialogChange:function(e,t){var n=this;this.selectUserValue=e,this.selectDepValue=t,this.$emit("update:userValue",this.selectUserValue),this.$emit("update:depValue",this.selectDepValue),this.$nextTick((function(){n.dispatch("ElFormItem","el.form.change",e.concat(t)),n.$emit("change",e,t,n.userSelectData,n.deptSelectData)}))},click:function(){this.disabled||(this.visible=!0)}}},$=D,T=Object(j["a"])($,k,I,!1,null,"2084a3ac",null),E=T.exports,L=n("9dba"),N={name:"EditRoleDialog",components:{RoleEmployeeSelect:w,WkUserDepDialogSelect:E},mixins:[L["a"]],props:{selectionList:Array,userShow:{type:Boolean,default:!0},visible:{type:Boolean,required:!0,default:!1}},data:function(){return{loading:!1,roleValue:[],ruleForm:{roleList:[],userIds:[],deptIds:[]}}},computed:Object(r["a"])(Object(r["a"])({},Object(g["c"])(["moduleAuth"])),{},{title:function(){return this.userShow?"复制角色":"编辑角色"},rules:function(){var e=this,t=function(t,n,a){e.ruleForm.userIds&&e.ruleForm.userIds.length>0||e.ruleForm.deptIds&&e.ruleForm.deptIds.length>0?a():a(new Error("请选择"))},n={roleList:[{required:!0,message:"请选择",trigger:"change"}]};return this.userShow&&(n.userIds=[{validator:t,trigger:""}]),n},roleSelectProps:function(){return{roleRequest:i["a"],showCustomRoles:!0}}}),watch:{},created:function(){if(this.userShow&&this.selectionList.length>0||!this.userShow&&1===this.selectionList.length){var e=this.selectionList[0];this.ruleForm.roleList=e.roleId?this.selectionList[0].roleId.split(","):[]}},methods:{close:function(){this.$emit("update:visible",!1)},sureClick:function(){var e=this;this.$refs.editRoleForm.validate((function(t){if(!t)return!1;var n=[],a=[];e.ruleForm.roleList.forEach((function(e){if(e.includes("@")){var t=e.split("@");if(t.length>1){var s=t[1].split(",");a=a.concat(s)}}else n.push(e)}));var s=Array.from(new Set(n.concat(a))),r=[],i=[];s.forEach((function(e){"string"===typeof e&&-1!==e.indexOf("-")?i.push(e):r.push(e)}));var l={roleIds:r};e.userShow?(l.userIds=e.ruleForm.userIds,l.deptIds=e.ruleForm.deptIds):l.userIds=e.selectionList.map((function(e){return e.userId})),Object(o["b"])(l).then((function(t){e.moduleAuth&&e.moduleAuth.customApp&&i.length?e.saveCustomRole(l.userIds||[],l.deptIds||[],i).then((function(){e.$message.success("操作成功"),e.$emit("change"),e.close()})).catch((function(){})):(e.$message.success("操作成功"),e.$emit("change"),e.close())})).catch((function(){}))}))},saveCustomRole:function(e,t,n){return new Promise((function(a,s){var r=[];n.forEach((function(e){var t=e.split("-"),n=r.find((function(e){return e.applicationId===t[0]}));n?n.roleIds.push(t[1]):r.push({applicationId:t[0],roleIds:[t[1]]})})),Object(l["l"])({userIds:e,deptIds:t,roles:r}).then((function(){a()})).catch((function(){s()}))}))}}},A=N,B=(n("d299"),Object(j["a"])(A,a,s,!1,null,"dd49f090",null));t["a"]=B.exports},5949:function(e,t,n){},"612a":function(e,t,n){"use strict";n.d(t,"d",(function(){return s})),n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i}));n("d3b7"),n("159b"),n("b64b");var a=n("b775");function s(e){return Object(a["a"])({url:"adminRole/getAllRoleList",method:"post",data:e})}function r(e){return Object(a["a"])({url:"adminRole/getRoleList",method:"post",data:e})}function o(e){return Object(a["a"])({url:"adminRole/queryAuthRole/".concat(e),method:"post"})}function i(e,t){return Object(a["a"])({url:"adminRole/updateAuthRole/".concat(e),method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}},"77d8":function(e,t,n){},8950:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{visible:e.visible,"append-to-body":!0,"close-on-click-modal":!1,title:"关联员工",width:"600px"},on:{close:e.handleCancel}},[n("div",{staticClass:"handle-box"},[n("flexbox",{staticClass:"handle-item",attrs:{align:"stretch"}},[n("div",{staticClass:"handle-item-name",staticStyle:{"margin-top":"8px"}},[e._v("选择员工：")]),e._v(" "),n("wk-user-dialog-select",{staticClass:"handle-item-content",attrs:{radio:!1},model:{value:e.selectUsers,callback:function(t){e.selectUsers=t},expression:"selectUsers"}})],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.handleConfirm(t)}}},[e._v("保存")]),e._v(" "),n("el-button",{nativeOn:{click:function(t){return e.handleCancel(t)}}},[e._v("取消")])],1)])},s=[],r=(n("a9e3"),n("8d55")),o=n("8f81"),i={name:"RelateEmpoyee",components:{WkUserDialogSelect:o["a"]},mixins:[],props:{visible:{type:Boolean,required:!0,default:!1},roleId:[Number,String],prevent:{type:Boolean,default:!1}},data:function(){return{loading:!0,selectUsers:[]}},computed:{},watch:{visible:function(e){e&&(this.selectUsers=[])}},mounted:function(){},methods:{handleCancel:function(){this.$emit("update:visible",!1)},handleConfirm:function(){var e=this;if(0==this.selectUsers.length)this.$message.error("请选择员工");else{if(this.prevent)return void this.$emit("save",this.selectUsers);Object(r["c"])({userIds:this.selectUsers,roleIds:[this.roleId]}).then((function(t){e.$message.success("操作成功"),e.$emit("save")})).catch((function(){}))}}}},l=i,c=(n("bd49"),n("2877")),u=Object(c["a"])(l,a,s,!1,null,"259ae360",null);t["a"]=u.exports},"8d55":function(e,t,n){"use strict";n.d(t,"d",(function(){return s})),n.d(t,"f",(function(){return r})),n.d(t,"g",(function(){return o})),n.d(t,"o",(function(){return i})),n.d(t,"e",(function(){return l})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return u})),n.d(t,"n",(function(){return d})),n.d(t,"h",(function(){return p})),n.d(t,"k",(function(){return h})),n.d(t,"i",(function(){return f})),n.d(t,"l",(function(){return m})),n.d(t,"j",(function(){return b})),n.d(t,"m",(function(){return v})),n.d(t,"a",(function(){return g}));var a=n("b775");function s(e){return Object(a["a"])({url:"adminRole/add",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function r(e){return Object(a["a"])({url:"adminRole/delete",method:"post",data:e})}function o(e){return Object(a["a"])({url:"adminRole/update",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function i(e){return Object(a["a"])({url:"adminRole/updateRoleMenu",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:e})}function l(e){return Object(a["a"])({url:"adminRole/copy",method:"post",data:e})}function c(e){return Object(a["a"])({url:"adminRole/relatedDeptUser",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:e})}function u(e){return Object(a["a"])({url:"adminRole/relatedUser",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:e})}function d(e){return Object(a["a"])({url:"adminRole/unbindingUser",method:"post",data:e})}function p(e){return Object(a["a"])({url:"adminRole/getRoleByType/".concat(e),method:"post"})}function h(e){return Object(a["a"])({url:"adminMenu/getMenuListByType/".concat(e),method:"post"})}function f(e){return Object(a["a"])({url:"crmField/queryRoleField",method:"post",data:e})}function m(e){return Object(a["a"])({url:"scrmField/queryRoleField",method:"post",data:e})}function b(e){return Object(a["a"])({url:"crmField/saveRoleField",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:e})}function v(e){return Object(a["a"])({url:"scrmField/saveRoleField",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:e})}function g(e){return Object(a["a"])({url:"adminRole/roles/users",method:"post",headers:{"Content-Type":"application/json;charset=UTF-8"},data:e})}},"9f1e":function(e,t,n){"use strict";n("5949")},bd49:function(e,t,n){"use strict";n("d699")},bd4a:function(e,t,n){},d299:function(e,t,n){"use strict";n("bd4a")},d699:function(e,t,n){},f468:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("flexbox",{staticClass:"xr-header"},[e.iconClass?n("div",{staticClass:"xr-header__icon",style:{backgroundColor:e.iconColor}},[n("i",{class:e.iconClass})]):e._e(),e._v(" "),n("div",{staticClass:"xr-header__label"},[e.$slots.label?e._t("label"):[e._v(e._s(e.label)),e._t("otherLabel")]],2),e._v(" "),e.showSearch?n("el-input",e._b({staticClass:"xr-header__search",style:{"margin-top":e.ftTop},attrs:{placeholder:e.placeholder},on:{input:e.inputChange},nativeOn:{keyup:function(t){return!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchClick(t)}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}},"el-input",e.inputAttr,!1),[n("el-button",{attrs:{slot:"suffix",type:"icon",icon:"wk wk-sousuo"},on:{click:e.searchClick},slot:"suffix"})],1):e._e(),e._v(" "),n("div",{staticClass:"xr-header__ft",style:{top:e.ftTop}},[e._t("ft")],2)],1)},s=[],r=(n("a9e3"),n("ac1f"),n("841c"),{name:"XrHeader",components:{},props:{iconClass:[String,Array],iconColor:String,label:String,showSearch:{type:Boolean,default:!1},placeholder:{type:String,default:"请输入内容"},ftTop:{type:String,default:"0"},content:[String,Number],inputAttr:{type:Object,default:function(){}}},data:function(){return{search:""}},computed:{},watch:{content:{handler:function(){this.search!=this.content&&(this.search=this.content)},immediate:!0}},mounted:function(){},beforeDestroy:function(){},methods:{inputChange:function(){this.$emit("update:content",this.search)},searchClick:function(){this.$emit("search",this.search)}}}),o=r,i=(n("9f1e"),n("2877")),l=Object(i["a"])(o,a,s,!1,null,"7eb05d11",null);t["a"]=l.exports},f98a:function(e,t,n){"use strict";n("77d8")},fae5:function(e,t,n){e.exports={colorPrimary:"#0052CC",colorBlack:"#172B4D",colorSuccess:"#36B37E",colorWarning:"#FFAB00",colorDanger:"#FF5630",colorN40:"#DFE1E6",axisLineColor:"#DFE1E6",axisLabelFontWeight:"500"}},ffd0:function(e,t,n){"use strict";n("fae5")}}]);