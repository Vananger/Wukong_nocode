(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-66bf79c8"],{"02f3":function(e,t,i){},"048b":function(e,t,i){},"0c38":function(e,t,i){"use strict";i("ba5b")},1459:function(e,t,i){"use strict";i("02f3")},"211d":function(e,t,i){"use strict";i("e1f6")},"324f":function(e,t,i){"use strict";i("048b")},"501a":function(e,t,i){"use strict";i("c337")},"60c9":function(e,t,i){"use strict";i("b2d9")},"64d6":function(e,t,i){},6590:function(e,t,i){},"68f0":function(e,t,i){},"6f58":function(e,t,i){},"73cc":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[e.indexAuth?i("user-app-header",{ref:"userAppHeader",attrs:{"module-detail":e.moduleObj,"category-id":e.categoryId,selects:e.selectedList,handles:e.controlBtnGroup,"scene-list":e.sceneList},on:{command:e.handleCommand,"on-export":function(t){e.handleToExport(!0)},"on-import":e.handleToImport,"on-handle":e.filterHeaderHandle}},[i("template",{slot:"newButton"},[e.canSave?i("el-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:function(t){e.handleCommand("create")}}},[e._v("\n        新建"+e._s(e.moduleObj.categoryName||e.moduleObj.name)+"\n      ")]):e._e()],1),e._v(" "),i("template",{slot:"input"},[i("el-input",{staticStyle:{width:"220px !important"},attrs:{placeholder:e.mainField.name||""},on:{change:e.handleSearch},nativeOn:{keyup:function(t){return!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch(t)}},model:{value:e.searchKeyword,callback:function(t){e.searchKeyword="string"===typeof t?t.trim():t},expression:"searchKeyword"}},[i("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},slot:"suffix"})])],1),e._v(" "),i("template",{slot:"filter-button"},[i("el-button",{staticClass:"filter-right__button",attrs:{icon:"wk wk-screening",type:"text"},on:{click:function(t){e.showFilter=!0}}},[e._v("\n        高级筛选\n      ")])],1),e._v(" "),i("template",{slot:"showFilterExport"},[e.showFilterExposedFields?i("div",{staticClass:"filter-right"},[i("el-button",{staticClass:"filter-right__button",attrs:{type:"text"},on:{click:e.handleToggleExposed}},[e._v("\n          "+e._s(e.exportBtn.name)+"\n          "),i("i",{class:e.exportBtn.class,staticStyle:{"font-weight":"700"}})])],1):e._e()])],2):e._e(),e._v(" "),i("div",[e.showFilterExposedFields&&e.showFilterExposedBtn&&e.indexAuth?i("filter-exposed-fields",{attrs:{obj:e.filterObj,"exposed-fields":e.exposedFields,"field-list":e.GetFilterFields(e.filterFieldsLib)},on:{filter:e.handleFilter,clear:e.clearFilterValue}}):e._e(),e._v(" "),i("div",{directives:[{name:"empty",rawName:"v-empty",value:!e.indexAuth,expression:"!indexAuth"}],staticClass:"crm-container",attrs:{"xs-empty-icon":"nopermission","xs-empty-text":"暂无权限"}},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],key:e.tableKey,ref:"elTable",class:e.crmTableClass,staticStyle:{width:"100%"},attrs:{"row-height":e.rowHeight,data:e.dataList,"cell-class-name":e.cellClassName,stripe:e.tableStyleObj.stripe,height:e.tableHeight,"row-key":"dataId","use-virtual":"","highlight-current-row":""},on:{"row-click":e.handleRowClick,"sort-change":e.handleSort,"header-dragend":e.handleDragend,"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{"show-overflow-tooltip":"","reserve-selection":"",type:"selection",align:"center",width:"55"}}),e._v(" "),e._l(e.fieldList,(function(t,a){return i("el-table-column",{key:a,attrs:{fixed:t.isLock,prop:t.prop,label:t.name,width:t.width,"class-name":t.width>60?"column":"",sortable:"custom","show-overflow-tooltip":""},scopedSlots:e._u([{key:"otherHeader",fn:function(a){return[i("el-button",{staticClass:"el-lock-btn",attrs:{icon:t.isLock?"wk wk-lock":"wk wk-unlock",type:"text"},on:{click:function(i){i.stopPropagation(),e.fieldFixed(t)}}}),e._v(" "),i("el-button",{staticClass:"el-filter-btn",attrs:{type:"text",icon:"wk wk-screening"},on:{click:function(i){i.stopPropagation(),e.showFilterClick(t)}}})]}},{key:"default",fn:function(a){var n=a.row,s=a.column;return["field_tag"===t.formType?[i("tag-view",{attrs:{"item-bottom":0,value:e.fieldFormatter(n,s,n[s.property],t)}})]:i("wk-field-view",{attrs:{props:t,"form-type":t.formType,"can-visit":t.canVisit,value:e.fieldFormatter(n,s,n[s.property],t)},on:{"union-click":function(i){e.handleClick(e.fieldFormatter(n,s,n[s.property],t))}},scopedSlots:e._u([{key:"default",fn:function(i){i.data;return[e._v("\n                "+e._s(e.fieldFormatter(n,s,n[s.property],t))+"\n              ")]}}])})]}}])})})),e._v(" "),i("el-table-column",{attrs:{resizable:!1,fixed:"right",width:"50"}}),e._v(" "),i("wk-empty",{attrs:{slot:"empty",props:{buttonTitle:"新建"+(e.moduleObj.categoryName||e.moduleObj.name),showButton:e.canSave}},on:{click:function(t){e.handleCommand("create")}},slot:"empty"}),e._v(" "),e.indexAuth?i("fields-set",{attrs:{slot:"other","module-id":e.moduleId,"category-id":e.categoryId,version:e.moduleObj.version},on:{change:e.handleRefresh},slot:"other"}):e._e()],2),e._v(" "),i("div",{staticClass:"p-contianer"},[i("el-dropdown",{attrs:{trigger:"click",placement:"top"}},[i("el-button",{staticClass:"dropdown-btn",attrs:{icon:"el-icon-s-fold"}}),e._v(" "),i("el-dropdown-menu",{staticClass:"wk-table-style-dropdown-menu",attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",[i("span",{on:{click:function(e){e.stopPropagation()}}},[i("el-switch",{on:{change:e.updateCustomConfig},model:{value:e.tableStyleObj.rightBorderShow,callback:function(t){e.$set(e.tableStyleObj,"rightBorderShow",t)},expression:"tableStyleObj.rightBorderShow"}}),e._v("\n                显示竖向分割线\n              ")],1)]),e._v(" "),i("el-dropdown-item",[i("span",{on:{click:function(e){e.stopPropagation()}}},[i("el-switch",{on:{change:e.updateCustomConfig},model:{value:e.tableStyleObj.bottomBorderShow,callback:function(t){e.$set(e.tableStyleObj,"bottomBorderShow",t)},expression:"tableStyleObj.bottomBorderShow"}}),e._v("\n                显示横向分割线\n              ")],1)]),e._v(" "),i("el-dropdown-item",[i("span",{on:{click:function(e){e.stopPropagation()}}},[i("el-switch",{on:{change:e.updateCustomConfig},model:{value:e.tableStyleObj.stripe,callback:function(t){e.$set(e.tableStyleObj,"stripe",t)},expression:"tableStyleObj.stripe"}}),e._v("\n                显示斑马纹\n              ")],1)])],1)],1),e._v(" "),i("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,"pager-count":5,layout:"prev, pager, next, sizes, total, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1),e._v(" "),e.showCreate?i("module-create",{attrs:{"module-id":e.moduleId,"category-id":e.categoryId,action:e.createAction},on:{close:function(t){e.showCreate=!1},"save-success":e.updateList}}):e._e(),e._v(" "),e.showDetail?i("module-detail",{staticClass:"d-view",attrs:{id:e.rowID,"module-id":e.clickedRow.moduleId,"page-list":e.dataList||[],"page-index":e.rowIndex},on:{"update:id":function(t){e.rowID=t},"update:pageIndex":function(t){e.rowIndex=t},handle:e.updateList,"hide-view":function(t){e.showDetail=!1}}}):e._e(),e._v(" "),e.transferDialogShow?i("transfer-handle",{attrs:{"module-id":e.moduleId,"selection-list":e.selectedList,"dialog-visible":e.transferDialogShow},on:{"update:dialogVisible":function(t){e.transferDialogShow=t},handle:e.updateList}}):e._e(),e._v(" "),e.moveCategoryDialogShow?i("move-category-handle",{attrs:{"module-id":e.moduleId,"category-id":e.categoryId,version:e.moduleObj.version,"selection-list":e.selectedList,"dialog-visible":e.moveCategoryDialogShow},on:{"update:dialogVisible":function(t){e.moveCategoryDialogShow=t},handle:e.updateList}}):e._e(),e._v(" "),i("scene-set",{attrs:{"dialog-visible":e.showSceneSet,"module-id":e.moduleId,"category-id":e.categoryId},on:{"update:dialogVisible":function(t){e.showSceneSet=t},"save-success":e.getSceneList}}),e._v(" "),e.showFilter?i("filter-form",{attrs:{"module-id":e.moduleId,"exposed-fields":e.exposedFields,"field-list":e.GetFilterFields(e.filterFieldsLib),"dialog-visible":e.showFilter,obj:e.filterObj},on:{"update:dialogVisible":function(t){e.showFilter=t},filter:e.handleFilter,changeObj:e.changeFilterObj,"save-success":e.getSceneList}}):e._e(),e._v(" "),e.showExport?i("module-export",{attrs:{"show-export":e.showExport,"module-obj":e.moduleObj,"is-all-export":e.isAllExport,"selected-list":e.selectedList,"scene-id":e.otherParams.sceneId,"search-keyword":e.searchKeyword},on:{"update:showExport":function(t){e.showExport=t},close:function(t){e.showExport=!1}}}):e._e(),e._v(" "),i("module-import",{attrs:{"show-import":e.showImport,"module-obj":e.moduleObj},on:{"update:showImport":function(t){e.showImport=t},change:function(t){e.showImport=!0},close:e.closeImport}})],1)},n=[],s=i("2909"),l=i("1da1"),o=i("5530"),r=(i("96cf"),i("7db0"),i("d3b7"),i("99af"),i("4de4"),i("ac1f"),i("1276"),i("159b"),i("d81d"),i("a630"),i("3ca3"),i("6062"),i("ddb0"),i("a15b"),i("caad"),i("2532"),i("b775"));function c(e){return Object(r["a"])({url:"moduleScene/list/".concat(e.moduleId),method:"post",data:e})}function u(e){return Object(r["a"])({url:"moduleScene/add",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function d(e){return Object(r["a"])({url:"moduleScene/update",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function f(e){return Object(r["a"])({url:"moduleScene/config",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function h(e){return Object(r["a"])({url:"moduleScene/delete/".concat(e.sceneId),method:"post",data:e})}function m(e){return Object(r["a"])({url:"moduleScene/default/".concat(e.sceneId),method:"post",data:e})}var p=i("eea8"),v=i("8967"),g=i("ad0e"),b=i("d155"),y=i("b0a1"),k=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("flexbox",{staticClass:"xr-header"},[i("div",{staticClass:"xr-header__container"},[i("flexbox",{attrs:{align:"center",justify:"flex-start"}},[i("div",{staticClass:"xr-header__container__title"},[i("span",[e._v(e._s(e.moduleDetail.categoryName||e.moduleDetail.name))])]),e._v(" "),e.moduleDetail.version!==e.getUpdateVersion()?i("el-tag",{staticClass:"xr-header__container__tag",attrs:{type:"danger",size:"mini"}},[e._v("有未发布更改")]):e._e()],1),e._v(" "),i("flexbox",{attrs:{align:"center",justify:"flex-end"}},[e._t("newButton"),e._v(" "),e.showDupCheck?i("el-button",{staticClass:"dropdown-btn",on:{click:function(t){e.dupCheckShow=!0}}},[e._v("查重")]):e._e(),e._v(" "),e.moreTypes.length>0?i("el-dropdown",{attrs:{trigger:"click"},on:{command:e.handleTypeDrop}},[i("el-button",{staticClass:"dropdown-btn",attrs:{icon:"el-icon-more"}}),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.moreTypes,(function(t,a){return i("el-dropdown-item",{key:a,attrs:{icon:e._f("wkIconPre")(t.icon),command:t.type}},[e._v("\n            "+e._s(t.name)+"\n          ")])})))],1):e._e()],2)],1),e._v(" "),e.indexAuth?[e.showSceneAndFilter?i("div",{staticClass:"container-title"},[e._t("input"),e._v(" "),i("div",{staticClass:"tabs"},[i("span",[e._v("显示：")]),e._v(" "),e._l(e.sceneList.slice(0,5),(function(t,a){return i("el-button",{key:a,class:{"el-button--selected":t.sceneId===e.activeSceneId},on:{click:function(i){e.handleSceneChange(t.sceneId)}}},[e._v("\n          "+e._s(t.name)+"\n        ")])})),e._v(" "),i("el-dropdown",{attrs:{trigger:"click"},on:{command:e.otherClick}},[i("el-button",{staticClass:"dropdown-btn"},[i("i",{staticClass:"el-icon-arrow-down",staticStyle:{"margin-left":"0"}})]),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.sceneList.length>5?e._l(e.sceneList.slice(5),(function(t,a){return i("el-dropdown-item",{key:a,attrs:{command:t.sceneId}},[e._v("\n                "+e._s(t.name)+"\n              ")])})):e._e(),e._v(" "),e.sceneShow?i("el-dropdown-item",{attrs:{divided:e.sceneList.length>5,command:"sceneSet"}},[i("span",{staticClass:"wk-filter-btn"},[i("i",{staticClass:"wk wk-manage"}),e._v("场景设置\n              ")])]):e._e()],2)],1)],2),e._v(" "),i("div",{staticClass:"filter-right"},[e._t("filter-button")],2),e._v(" "),e._t("showFilterExport")],2):i("flexbox",{staticClass:"xr-header__handle",attrs:{gutter:0}},[i("div",{staticClass:"selected—title"},[e._v("\n        已选中 "),i("span",{staticClass:"selected—count"},[e._v(e._s(e.selects.length))]),e._v(" 项\n      ")]),e._v(" "),e.selects.length>0?i("flexbox-item",{staticClass:"selection-items-box"},e._l(e.handles,(function(t,a){return i("el-button",{key:a,attrs:{icon:e._f("wkIconPre")(t.icon),size:"medium"},on:{click:function(i){e.selectionBarClick(t.value)}}},[e._v("\n          "+e._s(t.name)+"\n        ")])}))):e._e()],1)]:e._e()],2)},_=[],w=(i("a9e3"),i("163e")),x={name:"UserAppHeader",mixins:[w["a"]],props:{moduleDetail:{type:Object,default:function(){}},categoryId:[String,Number],hideFilter:{type:Boolean,default:!1},selects:{type:Array,default:function(){return[]}},handles:{type:Array,default:function(){return[]}},sceneList:{type:Array}},data:function(){return{showFilter:!1,showSceneSet:!1,dupCheckShow:!1,sceneShow:!0,activeSceneId:null,maxSceneLen:5,moduleEditVisible:!1,updateModuleFlag:!1}},computed:{showSceneAndFilter:function(){return!this.hideFilter&&(!this.selects||0===this.selects.length||0===this.handles.length)},showDupCheck:function(){return!1},moreTypes:function(){var e=[],t=this.moduleDetail,i="".concat(t.moduleId,"-").concat(this.categoryId||"");return this.$auth("".concat(t.applicationId,".").concat(i,".import"))&&e.push({type:"enter",name:"导入",icon:"import"}),this.$auth("".concat(t.applicationId,".").concat(i,".export"))&&e.push({type:"out",name:"导出",icon:"export"}),e},indexAuth:function(){if(!this.moduleDetail)return!1;var e="".concat(this.moduleDetail.moduleId,"-").concat(this.categoryId||"");return this.$auth("".concat(this.moduleDetail.applicationId,".").concat(e,".index"))}},watch:{sceneList:{handler:function(){if(this.sceneList.length){var e=this.sceneList.find((function(e){return 1===e.isDefault})),t=e?e.sceneId:this.sceneList[0].sceneId;this.handleSceneChange(t)}else this.activeSceneId=null},deep:!0,immediate:!0}},methods:{handleSceneChange:function(e){this.activeSceneId=e,this.$emit("on-handle","scene",e)},handleTypeDrop:function(e){"out"===e?this.$emit("on-export"):"enter"===e&&this.$emit("on-import")},selectionBarClick:function(e){this.$emit("command",e)},otherClick:function(e){"sceneSet"===e?this.$emit("on-handle",e):this.handleSceneChange(e)},handleCommand:function(e){},getUpdateVersion:function(){var e=this.getModuleObjById(this.moduleDetail.moduleId,{isLastVersion:!0});return e?e.version:void 0}}},I=x,C=(i("324f"),i("d58c"),i("2877")),S=Object(C["a"])(I,k,_,!1,null,"63182797",null),O=S.exports,j=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"filter-export-fields"},[i("div",{staticClass:"title"},[e._v("筛选条件")]),e._v(" "),i("filter-fields",{attrs:{form:e.form,"field-list":e.fieldList,disabled:""}}),e._v(" "),i("div",{staticClass:"filter-export-fields__handle"},[i("el-button",{attrs:{type:"primary"},on:{click:e.filterClick}},[e._v("筛选")]),e._v(" "),i("el-button",{on:{click:e.clearClick}},[e._v("清空外露筛选值")])],1)],1)},T=[],F=i("53ca"),L=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"filterFieldsForm",staticClass:"filter-fields"},e._l(e.form,(function(t,a){return i("el-row",{key:a},[i("el-col",{attrs:{span:6}},[i("el-select",{attrs:{disabled:e.disabled,placeholder:"请选择要筛选的字段名"},on:{change:function(i){e.fieldChange(t)},focus:e.fieldFocus},model:{value:t.fieldName,callback:function(i){e.$set(t,"fieldName",i)},expression:"formItem.fieldName"}},e._l(e.fieldList,(function(e){return i("el-option",{key:e.fieldName,attrs:{label:e.name,value:e.fieldName}})})))],1),e._v(" "),e.showCalCondition(t)?[i("el-col",{attrs:{span:1}},[e._v(" ")]),e._v(" "),i("el-col",{attrs:{span:4}},[i("el-select",{attrs:{placeholder:"请选择范围"},on:{change:function(i){e.selectChange(i,t)}},model:{value:t.condition,callback:function(i){e.$set(t,"condition",i)},expression:"formItem.condition"}},e._l(e.getConditionList(t),(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1)]:e._e(),e._v(" "),i("el-col",{attrs:{span:1}},[e._v(" ")]),e._v(" "),i("el-col",{staticStyle:{position:"relative"},attrs:{span:e.getValueSpan(t)?e.disabled?10:8:e.disabled?15:13}},["isNull"===t.condition||"isNotNull"===t.condition?[e._v("\n         \n      ")]:e.updateFlag?["flowStatus"===t.fieldName?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(e.flowStatusOptions,(function(e){return i("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}))):"flowType"===t.fieldName?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(e.flowTypeOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))):"stageStatus"===t.fieldName?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(e.stageStatusOptions,(function(e){return i("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}))):["select","checkbox","field_tag"].includes(t.formType)?i("el-select",{attrs:{"value-key":"key",multiple:"field_tag"!==t.formType,placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(t.optionsList,(function(e){return i("el-option",{key:e.key,attrs:{label:e.value,value:e}})}))):"field_attention"===t.formType?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(e.typeOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))):"number"===t.formType||"floatnumber"===t.formType||"percent"===t.formType?[14===t.type?i("div",[i("el-input-number",{staticClass:"small",staticStyle:{width:"100px"},attrs:{controls:!1},model:{value:t.min,callback:function(i){e.$set(t,"min",i)},expression:"formItem.min"}}),e._v(" "),i("span",[e._v("-")]),e._v(" "),i("el-input-number",{staticClass:"small",staticStyle:{width:"100px"},attrs:{controls:!1},model:{value:t.max,callback:function(i){e.$set(t,"max",i)},expression:"formItem.max"}})],1):i("el-input-number",{staticClass:"small",staticStyle:{width:"200px"},attrs:{controls:!1},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}})]:["date","datetime"].includes(t.formType)?[i("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:14===t.type,expression:"formItem.type === 14"}],ref:"wkDatePicker"+a,refInFor:!0,attrs:{"picker-options":e.getPickerOptions(t,a),type:e.getDateConfig(t).rangeType,"value-format":e.getDateConfig(t).format,"range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},on:{change:function(i){e.datePickerChange(t)}},model:{value:t.range,callback:function(i){e.$set(t,"range",i)},expression:"formItem.range"}}),e._v(" "),t.timeType?i("div",{staticClass:"date-range-content",on:{click:function(i){e.dateRangeSelect(t,a)}}},[e._v(e._s(t.timeTypeName))]):e._e(),e._v(" "),i("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:14!==t.type,expression:"formItem.type !== 14"}],attrs:{"value-format":e.getDateConfig(t).format,type:e.getDateConfig(t).type,placeholder:"选择日期 "},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}})]:"date_interval"===t.formType?i("el-date-picker",{staticStyle:{width:"100%","vertical-align":"middle"},attrs:{"value-format":t.dateValueFormat||"yyyy-MM-dd",disabled:t.disabled||e.disabled,clearable:"","start-placeholder":"开始日期","end-placeholder":"结束日期",type:"daterange"},on:{change:function(i){e.dateIntervalChange(t,a,i)}},model:{value:t.formValue,callback:function(i){e.$set(t,"formValue",i)},expression:"formItem.formValue"}}):"user"===t.formType||"single_user"===t.formType?i("wk-user-select",{staticStyle:{width:"100%"},attrs:{radio:!1},on:{change:function(i){e.userDepChange(t,arguments[0],arguments[1])}},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):"structure"===t.formType?i("wk-dep-select",{staticStyle:{width:"100%"},attrs:{radio:!1},on:{change:function(i){e.userDepChange(t,arguments[0],arguments[1])}},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):"boolean_value"===t.formType?i("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):"category"===t.formType?i("xh-prouct-cate",{attrs:{item:t,value:t.value},on:{"value-change":e.arrayValueChange}}):"map_address"===t.formType?i("v-distpicker",{attrs:{province:t.address.state,city:t.address.city,area:t.address.area},on:{province:function(i){e.selectProvince(i,t)},city:function(i){e.selectCity(i,t)},area:function(i){e.selectArea(i,t)}}}):"position"===t.formType?i("wk-position",{attrs:{"show-detail":!1,props:{checkStrictly:!0},"value-format":e.formatPosition},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):["data_union","data_union_multi"].includes(t.formType)?i("relevance-choose",{attrs:{"field-form":t,field:e.getFieldByFieldName(t.fieldName),"module-id":e.getUnionModuleId(t.fieldName),radio:!1,"use-last-verison":!1,"use-common":!0},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):i("el-input",{attrs:{placeholder:"多个条件请用；隔开"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}})]:e._e()],2),e._v(" "),e.disabled?e._e():i("el-col",{staticClass:"delete",attrs:{span:1}},[i("i",{staticClass:"el-icon-error delete-btn",on:{click:function(t){e.handleDelete(a)}}})]),e._v(" "),e.disabled?e._e():i("el-col",{attrs:{span:2}},[i("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:t.isOut,callback:function(i){e.$set(t,"isOut",i)},expression:"formItem.isOut"}},[e._v("外露")])],1)],2)})))},N=[],D=(i("b0c0"),i("f068")),$=i("5c0a"),E=i("de98"),A=i("5a8c"),P=i("0a3e"),V=i("604f"),B=i("4042"),R=i("3f26"),H=i("6bfe"),M=i("ab96"),U={name:"FilterFields",components:{WkUserSelect:$["a"],XhProuctCate:D["b"],VDistpicker:A["a"],WkDepSelect:E["a"],WkPosition:P["a"],RelevanceChoose:V["a"]},mixins:[B["a"]],props:{form:Array,fieldList:Array,disabled:{type:Boolean,default:!1}},data:function(){return{updateFlag:!0,formatPosition:R["d"],flowStatusOptions:R["c"],flowTypeOptions:M["a"].filter((function(e){return 0!==e.value})),stageStatusOptions:R["g"],typeOptions:[{label:"一星",value:1},{label:"二星",value:2},{label:"三星",value:3},{label:"四星",value:4},{label:"五星",value:5}]}},computed:{},watch:{form:function(){var e=this;this.$nextTick((function(){e.$el.scrollTop=e.$el.scrollHeight}))}},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{getConditionList:function(e){var t=e.formType,i=e.fieldName,a=Object(R["i"])(e);return a||(a=this.getAdvancedFilterOptions(t,i)),a},getDateConfig:function(e){var t=this.getFieldByFieldName(e.fieldName);return["date","datetime"].includes(t.formType)?"datetime"===t.formType?Object(R["e"])(1):Object(R["e"])(t.precisions):{}},showCalCondition:function(e){return this.getConditionList(e).length>0},getValueSpan:function(e){return this.showCalCondition(e)?8:13},getFieldByFieldName:function(e){var t=this.fieldList.find((function(t){return t.fieldName===e}));return t||{}},getUnionModuleId:function(e){var t=this.getFieldByFieldName(e);return t&&t.fieldUnionSaveBO&&t.fieldUnionSaveBO.targetModuleId?t.fieldUnionSaveBO.targetModuleId:null},dateIntervalChange:function(e){Object(H["b"])(e.formValue)?e.value=null:e.value={fromDate:e.formValue[0],toDate:e.formValue[1]}},selectProvince:function(e,t){t.address.state=e.value},selectCity:function(e,t){t.address.city=e.value},selectArea:function(e,t){t.address.area=e.value},arrayValueChange:function(e){e.value.length>0?(e.item.value=e.value,e.item.valueContent=e.valueContent):e.item.value=[]},userDepChange:function(e,t,i){e.valueContent=i},selectChange:function(e,t){var i=this.getConditionList(t);i.forEach((function(i){i.value===e&&(t.type=i.type)}))},fieldFocus:function(){this.$el.click()},fieldChange:function(e){var t=this,i=this.fieldList.find((function(t){return t.fieldName===e.fieldName}));i&&(e.formType=i.formType,e.name=i.name,this.getAdvancedFilterDefaultItemByFormType(e,i),"date_interval"===e.formType&&(this.$set(e,"formValue",[]),this.$set(e,"value",null))),this.$emit("on-field-change"),this.updateFlag=!1,this.$nextTick((function(){t.updateFlag=!0}))},dateRangeSelect:function(e,t){var i=this.$refs["wkDatePicker".concat(t)][0];this.$nextTick((function(){i.focus(),i.pickerVisible=!0}))},datePickerChange:function(e){e.timeTypeName="",e.timeType=""},getPickerOptions:function(e,t){for(var i=this,a=[{text:"本年度",value:"year"},{text:"上一年度",value:"lastYear"},{text:"下一年度",value:"nextYear"},{text:"上半年",value:"firstHalfYear"},{text:"下半年",value:"nextHalfYear"},{text:"本季度",value:"quarter"},{text:"上一季度",value:"lastQuarter"},{text:"下一季度",value:"nextQuarter"},{text:"本月",value:"month"},{text:"上月",value:"lastMonth"},{text:"下月",value:"nextMonth"},{text:"本周",value:"week"},{text:"上周",value:"lastWeek"},{text:"下周",value:"nextWeek"},{text:"今天",value:"today"},{text:"昨天",value:"yesterday"},{text:"明天",value:"tomorrow"},{text:"过去7天",value:"previous7day"},{text:"过去30天",value:"previous30day"},{text:"未来7天",value:"future7day"},{text:"未来30天",value:"future30day"}],n=[],s=function(t){var s=a[t];n.push({text:s.text,onClick:function(t){t.$emit("pick",[],!1),i.$nextTick((function(){e.timeTypeName=s.text,e.timeType=s.value}))}})},l=0;l<a.length;l++)s(l);return{shortcuts:n}},handleDelete:function(e){this.$emit("on-field-delete",e)}}},W=U,z=(i("adbd"),Object(C["a"])(W,L,N,!1,null,"286db440",null)),q=z.exports,G=(i("e9c4"),i("5319"),{mixins:[B["a"]],methods:{handleAddRow:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a={fieldName:"",name:"",formType:"",condition:"contains",type:3,value:"",formValue:null,typeOption:[],statusOption:[],typeId:"",statusId:"",address:{state:"",city:"",area:""},checked:i};t&&this.updateRowByField(a,t),e.push(a)},updateRowByField:function(e,t){switch(e.formType=t.formType,e.name=t.name,e.fieldName=t.fieldName,e.formType){case"user":case"single_user":case"structure":case"position":e.value=[];break;case"date":case"datetime":e.value="",this.$set(e,"timeType",""),this.$set(e,"timeTypeName",""),this.$set(e,"range",[]);break;case"select":case"checkbox":e.optionsList=t.optionsList||[],e.value=[];break;case"field_tag":e.tagList=t.tagList||[],e.value=[];break;case"number":case"floatnumber":case"percent":e.min="",e.max="",e.value="";break;default:e.value=""}var i=Object(R["i"])(e);if(i||(i=this.getAdvancedFilterOptions(e.formType,e.fieldName)),i.length>0){var a=i[0];e.condition=a.value,e.type=a.type}else e.condition="is",e.type=1},checkFilterForm:function(e){for(var t=0;t<e.length;t++){var i=this.form[t];if(!i.fieldName||""===i.fieldName)return this.$message.error("筛选的字段名称不能为空！"),!1;switch(i.formType){case"date":case"datetime":if("isNull"!==i.condition&&"isNotNull"!==i.condition)if(14===i.type){if(Object(H["b"])(i.timeType)&&Object(H["b"])(i.range))return this.$message.error("筛选内容不能为空！"),!1}else if(Object(H["b"])(i.value))return this.$message.error("筛选内容不能为空！"),!1;break;case"number":case"floatnumber":case"percent":if("isNull"!==i.condition&&"isNotNull"!==i.condition)if(14===i.type){if(Object(H["b"])(i.min)||Object(H["b"])(i.max))return this.$message.error("筛选内容不能为空！"),!1}else if(Object(H["b"])(i.value))return this.$message.error("筛选内容不能为空！"),!1;break;case"user":case"single_user":case"structure":case"category":case"checkbox":case"position":if((!i.value||0===i.value.length)&&"isNull"!==i.condition&&"isNotNull"!==i.condition)return this.$message.error("筛选内容不能为空！"),!1;break;default:if(Object(H["b"])(i.value)&&"isNull"!==i.condition&&"isNotNull"!==i.condition)return this.$message.error("筛选内容不能为空！"),!1}}return!0},getFilterForm:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[];return e.forEach((function(e){var i={formType:e.formType,fieldName:e.fieldName};if(["flowStatus","flowType","stageStatus"].includes(e.fieldName))Object(H["b"])(e.value)||t.push(Object(o["a"])(Object(o["a"])({},i),{},{type:e.type,values:[e.value]}));else switch(e.formType){case"date":case"datetime":var a=[];a=14===e.type?Object(H["b"])(e.timeType)?e.range:[e.timeType]:[e.value],t.push(Object(o["a"])(Object(o["a"])({},i),{},{type:e.type,values:a}));break;case"date_interval":t.push(Object(o["a"])(Object(o["a"])({},i),{},{type:e.type,values:[JSON.stringify(e.value)]}));break;case"number":case"floatnumber":var n=[];n=14===e.type?[Object(H["b"])(e.min)?"":e.min,Object(H["b"])(e.max)?"":e.max]:[e.value],t.push(Object(o["a"])(Object(o["a"])({},i),{},{type:e.type,values:n}));break;case"percent":var s=[];14===e.type?s=[Object(H["b"])(e.min)?"":Object(R["h"])(e.min,"/"),Object(H["b"])(e.max)?"":Object(R["h"])(e.max,"/")]:[5,6].includes(e.type)||(s=[Object(R["h"])(e.value,"/")]),t.push(Object(o["a"])(Object(o["a"])({},i),{},{type:e.type,values:s}));break;case"user":case"single_user":case"structure":t.push(Object(o["a"])(Object(o["a"])({},i),{},{type:e.type,values:e.value}));break;case"checkbox":case"select":t.push(Object(o["a"])(Object(o["a"])({},i),{},{type:e.type,values:e.value.map((function(e){return JSON.stringify(e)}))}));break;case"field_tag":t.push(Object(o["a"])(Object(o["a"])({},i),{},{type:e.type,values:e.value.map((function(e){return JSON.stringify(e)}))}));break;case"position":t.push(Object(o["a"])(Object(o["a"])({},i),{},{type:e.type,values:e.value.filter((function(e){return!Object(H["b"])(e.name)})).map((function(e){return JSON.stringify(e)}))}));break;case"data_union":case"data_union_multi":t.push(Object(o["a"])(Object(o["a"])({},i),{},{type:e.type,values:e.value.split(",")}));break;default:var l=[];if("string"===typeof e.value){var r=e.value.replace(/；/g,";");l=r.split(";").filter((function(e){return""!==e&&null!==e}))}else l=[e.value];t.push(Object(o["a"])(Object(o["a"])({},i),{},{type:e.type,values:l}))}})),t}}}),Q=i("ed08"),Y={name:"FilterExposedFields",components:{FilterFields:q},mixins:[G],props:{obj:{type:Object,required:!0},exposedFields:Array,fieldList:Array},data:function(){return{form:[]}},computed:{observerObj:function(){return[this.obj,this.fieldList]}},watch:{observerObj:{handler:function(){var e=this,t=Object(Q["t"])(this.obj.form).filter((function(e){return e.checked}));!t.length&&this.fieldList.length&&this.exposedFields.length&&this.exposedFields.forEach((function(i){var a=e.fieldList.find((function(e){return e.fieldName===i}));a&&e.handleAddRow(t,a,!0)})),this.form=t},deep:!0,immediate:!0}},methods:{filterClick:function(){var e=this.checkFilterForm(this.form);e&&this.$emit("filter",{obj:this.getFilterForm(this.form),form:this.form})},getSettingValueType:function(e){if(e&&e.length>0){var t=e[0];return Object(F["a"])(t)}return[]},clearClick:function(){this.$emit("clear",this.form)}}},J=Y,K=(i("60c9"),Object(C["a"])(J,j,T,!1,null,"0aea7f00",null)),X=K.exports,Z=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{visible:e.visible,"append-to-body":!0,"close-on-click-modal":!1,title:"场景管理",width:"700px"},on:{"update:visible":function(t){e.visible=t},close:e.handleCancel}},[i("div",{staticClass:"scene-name"},[e._v("您可通过拖拽管理场景")]),e._v(" "),i("flexbox",{staticClass:"scene-list"},[i("div",{staticClass:"scene-list-box"},[i("flexbox",{staticClass:"scene-list-head"},[i("el-checkbox",{attrs:{indeterminate:e.isleftIndeterminate},on:{change:e.handleleftCheckAllChange},model:{value:e.checkleftAll,callback:function(t){e.checkleftAll=t},expression:"checkleftAll"}}),e._v(" "),i("div",{staticClass:"scene-list-head-name"},[e._v("显示的场景")]),e._v(" "),i("div",{staticClass:"scene-list-head-detail"},[e._v("\n          "+e._s(e.leftCheckItems.length+"/"+e.checkedLeftData.length)+"\n        ")])],1),e._v(" "),i("div",{staticClass:"scene-list-body"},[i("draggable",{staticStyle:{"min-height":"100px"},attrs:{move:e.leftMove,options:{group:"list",forceFallback:!1,fallbackClass:"draggingStyle",filter:".ignore"}},on:{sort:e.leftSortCallback,end:e.leftMoveEnd},model:{value:e.checkedLeftData,callback:function(t){e.checkedLeftData=t},expression:"checkedLeftData"}},[e._l(e.checkedLeftData,(function(t,a){return[i("flexbox",{key:t.name,staticClass:"list-item",class:{ignore:0!==t.isSystem}},[i("div",{staticClass:"default-mark",class:{"default-mark-active":t.sceneId===e.defaultId}}),e._v(" "),i("el-checkbox",{staticClass:"list-item-check",on:{change:e.leftCheckItemChange},model:{value:t.check,callback:function(i){e.$set(t,"check",i)},expression:"item.check"}}),e._v(" "),i("div",{staticClass:"list-item-name"},[e._v(e._s(t.name))]),e._v(" "),i("div",{staticClass:"list-item-handle"},[0===t.isSystem?[i("i",{staticClass:"el-icon-edit icon",on:{click:function(i){e.itemHandle("edit",t,a)}}}),e._v(" "),i("i",{staticClass:"el-icon-delete icon",on:{click:function(i){e.itemHandle("delete",t,a)}}})]:e._e(),e._v(" "),i("el-dropdown",{on:{command:function(i){e.defaultHandle(arguments[0],t)}}},[i("i",{staticClass:"wk wk-manage icon"}),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"default"}},[e._v("设置为默认场景")])],1)],1)],2)],1)]}))],2)],1)],1),e._v(" "),i("div",{staticClass:"scene-middle-list"},[i("el-button",{staticClass:"scene-middle-left-button",class:{"scene-middle-button-select":e.rightCheckItems.length},attrs:{disabled:!e.rightCheckItems.length},on:{click:function(t){e.changePositon("left")}}},[i("i",{staticClass:"el-icon-arrow-left scene-middle-icon"})]),e._v(" "),i("el-button",{staticClass:"scene-middle-right-button",class:{"scene-middle-button-select":e.leftCheckItems.length},attrs:{disabled:!e.leftCheckItems.length},on:{click:function(t){e.changePositon("right")}}},[i("i",{staticClass:"el-icon-arrow-right scene-middle-icon"})])],1),e._v(" "),i("div",{staticClass:"scene-list-box"},[i("flexbox",{staticClass:"scene-list-head"},[i("el-checkbox",{attrs:{indeterminate:e.isRightIndeterminate},on:{change:e.handleRightCheckAllChange},model:{value:e.checkRightAll,callback:function(t){e.checkRightAll=t},expression:"checkRightAll"}}),e._v(" "),i("div",{staticClass:"scene-list-head-name"},[e._v("隐藏的场景")]),e._v(" "),i("div",{staticClass:"scene-list-head-detail"},[e._v("\n          "+e._s(e.rightCheckItems.length+"/"+e.checkedRightData.length)+"\n        ")])],1),e._v(" "),i("div",{staticClass:"scene-list-body"},[i("draggable",{staticStyle:{"min-height":"100px"},attrs:{move:e.rightMove,options:{group:"list",forceFallback:!1,fallbackClass:"draggingStyle"}},on:{end:e.rightMoveEnd},model:{value:e.checkedRightData,callback:function(t){e.checkedRightData=t},expression:"checkedRightData"}},e._l(e.checkedRightData,(function(t){return i("flexbox",{key:t.name,staticClass:"list-item"},[i("el-checkbox",{staticClass:"list-item-check",staticStyle:{"margin-left":"9px"},on:{change:e.rightCheckItemChange},model:{value:t.check,callback:function(i){e.$set(t,"check",i)},expression:"item.check"}}),e._v(" "),i("div",{staticClass:"list-item-name"},[e._v(e._s(t.name))])],1)})))],1)],1)]),e._v(" "),i("div",{staticClass:"handle-bar"},[i("el-button",{staticStyle:{"padding-right":"0","padding-left":"0"},attrs:{type:"text"},on:{click:function(t){e.addAndEditScene("add",{})}}},[e._v("+ 新建场景")])],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("保存")]),e._v(" "),i("el-button",{nativeOn:{click:function(t){return e.handleCancel(t)}}},[e._v("取消")])],1),e._v(" "),e.showCreateScene?i("scene-create",{attrs:{"module-id":e.moduleId,"field-list":e.fieldList,obj:e.filterObj,name:e.filterName,"scene-id":e.filterEditId,"is-default":e.filterDefault},on:{close:function(t){e.showCreateScene=!1},"save-success":e.updateSceneList}}):e._e()],1)},ee=[],te=(i("a434"),i("25f0"),i("4e82"),i("0edd")),ie=i("b76a"),ae=i.n(ie),ne=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:e.sceneId?"编辑场景":"新建场景",visible:e.dialogVisible,"close-on-click-modal":!1,width:"800px","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleCancel}},[i("div",{staticClass:"safe-bottom scene-name"},[i("div",{staticClass:"safe-bottom"},[e._v("场景名称")]),e._v(" "),i("el-input",{staticClass:"safe-bottom",attrs:{maxlength:10,placeholder:"场景名称，最多10个字符"},model:{value:e.sceneName,callback:function(t){e.sceneName="string"===typeof t?t.trim():t},expression:"sceneName"}})],1),e._v(" "),i("div",{staticClass:"safe-bottom"},[e._v("筛选条件")]),e._v(" "),i("div",{staticClass:"safe-bottom filter-container",attrs:{id:"filter-container"}},e._l(e.form,(function(t,a){return i("el-row",{key:a,attrs:{gutter:15}},[i("el-col",{attrs:{span:7}},[i("el-select",{attrs:{placeholder:"请选择要筛选的字段名"},on:{change:function(i){e.fieldChange(t)}},model:{value:t.fieldName,callback:function(i){e.$set(t,"fieldName",i)},expression:"formItem.fieldName"}},e._l(e.fieldList,(function(e){return i("el-option",{key:e.fieldName,attrs:{label:e.name,value:e.fieldName}})})))],1),e._v(" "),e.showCalCondition(t.formType,t.fieldName)?i("el-col",{attrs:{span:5}},[i("el-select",{attrs:{placeholder:"请选择范围"},on:{change:function(i){e.selectChange(i,t)}},model:{value:t.condition,callback:function(i){e.$set(t,"condition",i)},expression:"formItem.condition"}},e._l(e.getConditionList(t.formType,t.fieldName),(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1):e._e(),e._v(" "),i("el-col",{staticStyle:{position:"relative"},attrs:{span:e.getValueSpan(t.formType,t.fieldName)}},[["isNull","isNotNull"].includes(t.condition)?[e._v("\n           \n        ")]:["flowStatus"===t.fieldName?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(e.flowStatusOptions,(function(e){return i("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}))):"flowType"===t.fieldName?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(e.flowTypeOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))):"stageStatus"===t.fieldName?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(e.stageStatusOptions,(function(e){return i("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}))):["select","checkbox"].includes(t.formType)?i("el-select",{attrs:{"value-key":"key",multiple:"",placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(t.optionsList,(function(e){return i("el-option",{key:e.key,attrs:{label:e.value,value:e}})}))):"field_attention"===t.formType?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(e.typeOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))):["number","floatnumber","percent"].includes(t.formType)?[14===t.type?i("div",[i("el-input-number",{staticClass:"small",staticStyle:{width:"100px"},attrs:{controls:!1},model:{value:t.min,callback:function(i){e.$set(t,"min",i)},expression:"formItem.min"}}),e._v(" "),i("span",[e._v("-")]),e._v(" "),i("el-input-number",{staticClass:"small",staticStyle:{width:"100px"},attrs:{controls:!1},model:{value:t.max,callback:function(i){e.$set(t,"max",i)},expression:"formItem.max"}})],1):i("el-input-number",{staticClass:"small",attrs:{controls:!1},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}})]:"date"===t.formType||"datetime"===t.formType?[i("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:14===t.type,expression:"formItem.type === 14"}],ref:"wkDatePicker"+a,refInFor:!0,attrs:{"picker-options":e.getPickerOptions(t,a),type:e.getDateConfig(t).rangeType,"value-format":e.getDateConfig(t).format,"range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},on:{change:function(i){e.datePickerChange(t)}},model:{value:t.range,callback:function(i){e.$set(t,"range",i)},expression:"formItem.range"}}),e._v(" "),t.timeType?i("div",{staticClass:"date-range-content",on:{click:function(i){e.dateRangeSelect(t,a)}}},[e._v("\n              "+e._s(t.timeTypeName)+"\n            ")]):e._e(),e._v(" "),i("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:14!==t.type,expression:"formItem.type !== 14"}],attrs:{"value-format":e.getDateConfig(t).format,type:e.getDateConfig(t).type,placeholder:"选择日期"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}})]:"date_interval"===t.formType?i("el-date-picker",{staticStyle:{width:"100%","vertical-align":"middle"},attrs:{"value-format":t.dateValueFormat||"yyyy-MM-dd",clearable:"","start-placeholder":"开始日期","end-placeholder":"结束日期",type:"daterange"},on:{change:function(i){e.dateIntervalChange(t,a,i)}},model:{value:t.formValue,callback:function(i){e.$set(t,"formValue",i)},expression:"formItem.formValue"}}):"user"===t.formType||"single_user"===t.formType?i("wk-user-select",{attrs:{radio:!1},on:{change:function(i){e.userDepChange(t,arguments[0],arguments[1])}},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):"structure"===t.formType?i("wk-dep-select",{attrs:{radio:!1},on:{change:function(i){e.userDepChange(t,arguments[0],arguments[1])}},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):"boolean_value"===t.formType?i("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):"map_address"===t.formType?i("v-distpicker",{attrs:{province:t.address.state,city:t.address.city,area:t.address.area},on:{province:function(i){e.selectProvince(i,t)},city:function(i){e.selectCity(i,t)},area:function(i){e.selectArea(i,t)}}}):"position"===t.formType?i("wk-position",{attrs:{"show-detail":!1,"value-format":e.formatPosition,props:{checkStrictly:!0}},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):["field_tag"].includes(t.formType)?i("el-select",{attrs:{multiple:!0},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(t.tagList,(function(e){return i("el-option",{key:e.key,attrs:{label:e.value,value:e}})}))):["data_union","data_union_multi"].includes(t.formType)?i("relevance-choose",{attrs:{"field-form":t,field:e.getFieldByFieldName(t.fieldName),"module-id":e.getUnionModuleId(t.fieldName),radio:!1,"use-last-verison":!1,"use-common":!0},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):i("el-input",{attrs:{placeholder:"多个条件请用；隔开"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}})]],2),e._v(" "),i("el-col",{staticClass:"delete",attrs:{span:3}},[i("i",{staticClass:"wk wk-icon-refuse delete-btn",on:{click:function(t){e.handleDelete(a)}}})])],1)}))),e._v(" "),i("p",{directives:[{name:"show",rawName:"v-show",value:e.showErrors,expression:"showErrors"}],staticClass:"el-icon-warning warning-info safe-bottom"},[i("span",{staticClass:"desc"},[e._v("筛选条件中有重复项！")])]),e._v(" "),i("el-button",{staticClass:"safe-bottom",staticStyle:{"padding-right":"0","padding-left":"0"},attrs:{type:"text"},on:{click:function(t){e.handleAddRow(e.form)}}},[e._v("+ 添加筛选条件")]),e._v(" "),i("div",{staticClass:"save"},[i("el-checkbox",{model:{value:e.saveDefault,callback:function(t){e.saveDefault=t},expression:"saveDefault"}},[e._v("设置为默认")])],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("确 定")]),e._v(" "),i("el-button",{on:{click:e.handleCancel}},[e._v("取 消")])],1)],1)},se=[],le=(i("fb6a"),{name:"SceneCreate",components:{WkUserSelect:$["a"],VDistpicker:A["a"],WkDepSelect:E["a"],WkPosition:P["a"],RelevanceChoose:V["a"]},mixins:[G],props:{visible:{type:Boolean,default:!1},fieldList:{type:Array,default:function(){return[]}},obj:{type:Object,required:!0,default:function(){}},moduleId:[String,Number],sceneId:[String,Number],name:String,isDefault:Boolean},data:function(){return{dialogVisible:!0,sceneName:"",form:[],showErrors:!1,saveDefault:!1,timeTypes:[{text:"本年度",value:"year"},{text:"上一年度",value:"lastYear"},{text:"下一年度",value:"nextYear"},{text:"上半年",value:"firstHalfYear"},{text:"下半年",value:"nextHalfYear"},{text:"本季度",value:"quarter"},{text:"上一季度",value:"lastQuarter"},{text:"下一季度",value:"nextQuarter"},{text:"本月",value:"month"},{text:"上月",value:"lastMonth"},{text:"下月",value:"nextMonth"},{text:"本周",value:"week"},{text:"上周",value:"lastWeek"},{text:"下周",value:"nextWeek"},{text:"今天",value:"today"},{text:"昨天",value:"yesterday"},{text:"明天",value:"tomorrow"},{text:"过去7天",value:"previous7day"},{text:"过去30天",value:"previous30day"},{text:"未来7天",value:"future7day"},{text:"未来30天",value:"future30day"}],typeOptions:[{label:"一星",value:1},{label:"二星",value:2},{label:"三星",value:3},{label:"四星",value:4},{label:"五星",value:5}],formatPosition:R["d"],flowStatusOptions:R["c"],flowTypeOptions:M["a"].filter((function(e){return 0!==e.value})),stageStatusOptions:R["g"]}},computed:{},watch:{form:{handler:function(e){this.$nextTick((function(){var e=document.getElementById("filter-container");e&&(e.scrollTop=e.scrollHeight)}))},deep:!0,immediate:!0}},mounted:function(){var e=this,t=Object(Q["t"])(this.obj.obj),i=[];if(this.sceneId){var a=function(a){var n=t[a],s=e.fieldList.find((function(e){return e.fieldName===n.fieldName}));if(!s)return"continue";var l=e.getItem();if(l.fieldName=n.fieldName,l.formType=n.formType,l.type=n.type,e.updateRowByField(l,s),e.getConditionList(n.formType,n.fieldName).forEach((function(e){n.type===e.type&&(l.condition=e.value)})),["date","datetime"].includes(n.formType))if(l.value="",e.$set(l,"timeType",""),e.$set(l,"timeTypeName",""),e.$set(l,"range",[]),14===l.type)if(Object(H["a"])(n.values)&&n.values.length>0)if(1===n.values.length){l.timeType=n.values[0];var o=e.timeTypes.find((function(e){return e.value===l.timeType}));o&&(l.timeTypeName=o.text)}else e.$set(l,"range",n.values.slice(0,2));else l.value="";else l.value=n.values[0];else["number","floatnumber","percent"].includes(n.formType)?(l.min="",l.max="",l.value="",14===l.type?(l.min=Object(H["a"])(n.values)&&!Object(H["b"])(n.values[0])?n.values[0]:"",l.max=Object(H["a"])(n.values)&&!Object(H["b"])(n.values[1])?n.values[1]:""):l.value=n.values[0]):["select","checkbox"].includes(n.formType)?l.value=n.values.map((function(e){return JSON.parse(e)})):["user","single_user","structure","position"].includes(n.formType)?l.value=n.values:l.value=n.values[0];i.push(l)};for(var n in t)a(n)}this.form=i,this.form.length||this.handleAddRow(this.form),this.saveDefault=this.isDefault||!1,this.sceneName=this.name||""},methods:{getConditionList:function(e,t){var i=Object(R["i"])({formType:e,fieldName:t});return i||(i=this.getAdvancedFilterOptions(e,t)),i},getDateConfig:function(e){var t=this.getFieldByFieldName(e.fieldName);return["date","datetime"].includes(t.formType)?"datetime"===t.formType?Object(R["e"])(1):Object(R["e"])(t.precisions):{}},getItem:function(){return{fieldName:"",name:"",formType:"",condition:"contains",type:3,value:"",typeOption:[],statusOption:[],typeId:"",statusId:"",address:{state:"",city:"",area:""},checked:!1}},dateIntervalChange:function(e){Object(H["b"])(e.formValue)?e.value=null:e.value={fromDate:e.formValue[0],toDate:e.formValue[1]}},selectProvince:function(e,t){t.address.state=e.value},selectCity:function(e,t){t.address.city=e.value},selectArea:function(e,t){t.address.area=e.value},userDepChange:function(e,t,i){e.valueContent=i},selectChange:function(e,t){this.getConditionList(t.formType,t.fieldName).forEach((function(i){i.value===e&&(t.type=i.type)}))},showCalCondition:function(e,t){return this.getConditionList(e,t).length>0},fieldChange:function(e){var t=this.fieldList.find((function(t){return t.fieldName===e.fieldName}));t&&this.updateRowByField(e,t),this.getError()},getValueSpan:function(e,t){return this.showCalCondition(e,t)?9:14},getFieldByFieldName:function(e){var t=this.fieldList.find((function(t){return t.fieldName===e}));return t||{}},getUnionModuleId:function(e){var t=this.getFieldByFieldName(e);return t&&t.fieldUnionSaveBO&&t.fieldUnionSaveBO.targetModuleId?t.fieldUnionSaveBO.targetModuleId:null},getError:function(){this.showErrors=!1;for(var e=[],t=0;t<this.form.length;t++){var i=this.form[t];if(e.includes(i.fieldName)){this.showErrors=!0;break}e.push(i.fieldName)}},dateRangeSelect:function(e,t){var i=this.$refs["wkDatePicker".concat(t)][0];this.$nextTick((function(){i.focus(),i.pickerVisible=!0}))},datePickerChange:function(e){e.timeTypeName="",e.timeType=""},getPickerOptions:function(e,t){for(var i=this,a=[],n=function(t){var n=i.timeTypes[t];a.push({text:n.text,onClick:function(t){t.$emit("pick",[],!1),i.$nextTick((function(){e.timeTypeName=n.text,e.timeType=n.value}))}})},s=0;s<this.timeTypes.length;s++)n(s);return{shortcuts:a}},handleDelete:function(e){var t=this;this.$confirm("您确定要删除这一条数据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.form.splice(e,1),t.getError()})).catch((function(){}))},handleCancel:function(){this.dialogVisible=!1,this.$emit("close")},handleConfirm:function(){var e=this;if(this.showErrors)this.$message.error("筛选条件中有重复项！");else if(this.sceneName){var t=this.checkFilterForm(this.form);if(t){var i=this.getFilterForm(this.form);this.sceneId?d({moduleId:this.moduleId,isDefault:this.saveDefault?1:0,name:this.sceneName,sceneId:this.sceneId,data:JSON.stringify(i)}).then((function(){e.$message.success("编辑成功"),e.$emit("save-success"),e.handleCancel()})).catch((function(){})):u({moduleId:this.moduleId,isDefault:this.saveDefault?1:0,name:this.sceneName,data:JSON.stringify(i)}).then((function(){e.$emit("save-success"),e.$message.success("创建成功"),e.handleCancel()})).catch((function(){}))}}else this.$message.error("场景名称不能为空！")}}}),oe=le,re=(i("d241"),Object(C["a"])(oe,ne,se,!1,null,"1199be83",null)),ce=re.exports,ue={name:"SceneSet",components:{draggable:ae.a,SceneCreate:ce},mixins:[w["a"]],props:{dialogVisible:{type:Boolean,required:!0,default:!1},moduleId:{type:String},categoryId:[String,Number]},data:function(){return{defaultId:"",visible:!1,isleftIndeterminate:!1,checkleftAll:!1,checkedLeftData:[],leftCheckItems:[],isRightIndeterminate:!1,checkRightAll:!1,checkedRightData:[],rightCheckItems:[],moveItem:{},handlDefaultItem:{},showCreateScene:!1,fieldList:[],filterObj:{form:[]},filterName:"",filterDefault:!1,filterEditId:""}},computed:{moduleObj:function(){return this.getModuleObjById(this.moduleId,{categoryId:this.categoryId})||{}}},watch:{dialogVisible:{handler:function(e){this.visible=e,e&&this.getSceneList()},deep:!0,immediate:!0}},mounted:function(){},methods:{getSceneList:function(){var e=this;c({moduleId:this.moduleId}).then((function(t){e.checkedLeftData=[],e.checkedRightData=[],t.data.forEach((function(t){0==t.isHide?e.checkedLeftData.push(t):1==t.isHide&&e.checkedRightData.push(t)}));var i=e.checkedLeftData.filter((function(e){return 1==e.isDefault}));i&&i.length>0?e.defaultId=i[0].sceneId:e.defaultId=""})).catch((function(){}))},handleConfirm:function(){var e=this;if(this.checkedLeftData.length){var t=this.checkedLeftData.filter((function(t){return t.sceneId===e.defaultId}));t.length||(this.defaultId=""),f({moduleId:this.moduleId,noHideIds:this.checkedLeftData.map((function(e){return e.sceneId})),hideIds:this.checkedRightData.map((function(e){return e.sceneId}))}).then((function(t){e.$message({type:"success",message:"操作成功"}),e.handleCancel(),e.$emit("save-success")})).catch((function(){}))}else this.$message.error("场景不能全部隐藏！")},updateSceneList:function(){this.getSceneList(),this.$emit("save-success")},itemHandle:function(e,t,i){var a=this;"edit"===e?this.addAndEditScene("edit",t):"delete"===e&&this.$confirm("您确定要删除这一条数据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){h({sceneId:t.sceneId}).then((function(e){a.$message({type:"success",message:"删除成功"}),a.checkedLeftData.splice(i,1),a.leftCheckItemChange(),a.$emit("save-success")})).catch((function(){}))})).catch((function(){})),this.$emit("save-success")},defaultHandle:function(e,t){var i=this;m({sceneId:t.sceneId}).then((function(e){i.$message({type:"success",message:"操作成功"}),i.defaultId=t.sceneId})).catch((function(){}))},addAndEditScene:function(e,t){var i=this;Object(te["d"])({moduleId:this.moduleId,categoryId:this.moduleObj.categoryId,version:this.moduleObj.version}).then((function(a){if(i.fieldList=a.data.filter((function(e){return!(e.groupId||e.isHidden||"detail_table"===e.formType||["currentFlowId","categoryId"].includes(e.fieldName))&&!["file","handwriting_sign","desc_text","detail_table","data_union","data_union_multi","statistic","field_group"].includes(e.formType)})),"edit"===e){var n;try{var s=JSON.parse(t.data);s.map((function(e){return"percent"===e.formType&&(e.values=e.values.map((function(e){return Object(R["h"])(e,"*")}))),e})),n=s}catch(l){n=t.data||{}}i.filterObj={form:[],obj:n},i.filterName=t.name,i.filterDefault=1==t.isDefault,i.filterEditId=t.sceneId.toString()}else i.filterObj={form:[]},i.filterEditId="",i.filterName="",i.filterDefault=!1;i.showCreateScene=!0})).catch((function(){}))},handleCancel:function(){this.visible=!1,this.$emit("update:dialogVisible",!1)},leftSortCallback:function(e){var t=this,i=e.oldIndex,a=e.newIndex;a<=2&&this.$nextTick((function(){var e=t.checkedLeftData;e.splice.apply(e,[i,0].concat(Object(s["a"])(e.splice(a,1))))}))},rightMoveEnd:function(e){this.moveItem.check=!1,this.leftCheckItemChange(),this.rightCheckItemChange()},rightMove:function(e){this.moveItem=e.draggedContext.element},leftMoveEnd:function(e){this.moveItem.check=!1,this.leftCheckItemChange(),this.rightCheckItemChange()},leftMove:function(e){this.moveItem=e.draggedContext.element},handleleftCheckAllChange:function(e){e&&(this.isleftIndeterminate=!1),this.checkedLeftData.forEach((function(t){t.check=e})),this.leftCheckItems=e?this.checkedLeftData.filter((function(e){return e.check})):[]},leftCheckItemChange:function(){this.leftCheckItems=this.checkedLeftData.filter((function(e){return 1==e.check})),this.leftCheckItems.length>0?this.leftCheckItems.length==this.checkedLeftData.length?(this.checkleftAll=!0,this.isleftIndeterminate=!1):(this.checkleftAll=!1,this.isleftIndeterminate=!0):(this.checkleftAll=!1,this.isleftIndeterminate=!1)},handleRightCheckAllChange:function(e){e&&(this.isRightIndeterminate=!1),this.checkedRightData.forEach((function(t){t.check=e})),this.rightCheckItems=e?this.checkedRightData:[]},rightCheckItemChange:function(){this.rightCheckItems=this.checkedRightData.filter((function(e){return 1==e.check})),this.rightCheckItems.length>0?this.rightCheckItems.length==this.checkedRightData.length?(this.checkRightAll=!0,this.isRightIndeterminate=!1):(this.checkRightAll=!1,this.isRightIndeterminate=!0):(this.checkRightAll=!1,this.isRightIndeterminate=!1)},changePositon:function(e){var t=this;"left"==e?(this.checkedRightData=this.checkedRightData.filter((function(e,i,a){var n=!1;return t.rightCheckItems.forEach((function(t,i){e.sceneId==t.sceneId&&(n=!0)})),!n})),this.rightCheckItems.forEach((function(e,i){e.check=!1,t.checkedLeftData.push(e)})),this.rightCheckItems=[],this.isRightIndeterminate=!1,this.checkRightAll=!1,this.checkedLeftData.sort((function(e,t){return e.isSystem||t.isSystem?e.isSystem&&t.isSystem?e.sort-t.sort:e.isSystem?-1:1:0})),this.leftCheckItemChange(),this.rightCheckItemChange()):(this.checkedLeftData=this.checkedLeftData.filter((function(e,i,a){var n=!1;return t.leftCheckItems.forEach((function(t,i){e.sceneId==t.sceneId&&(n=!0)})),!n})),this.leftCheckItems.forEach((function(e,i){e.check=!1,t.checkedRightData.push(e)})),this.leftCheckItems=[],this.isleftIndeterminate=!1,this.checkleftAll=!1,this.leftCheckItemChange(),this.rightCheckItemChange())}}},de=ue,fe=(i("8577"),Object(C["a"])(de,Z,ee,!1,null,"1dfdd622",null)),he=fe.exports,me=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main"},[a("el-dialog",{attrs:{visible:e.showExport,title:"导出"+e.moduleObj.name,"append-to-body":!0,"close-on-click-modal":!1,width:"750px"},on:{close:e.closeView}},[a("div",{staticClass:"dialog-body"},[a("el-steps",{attrs:{active:e.stepsActive,"align-center":""}},[a("el-step",{attrs:{title:"导出配置"}}),e._v(" "),a("el-step",{attrs:{title:"导出完成"}})],1),e._v(" "),1!=e.stepsActive||e.exportLoading?e._e():a("div",{staticClass:"step-section"},[a("flexbox",{staticClass:"field",attrs:{direction:"column",align:"stretch"}},[a("div",{staticClass:"title"},[e._v("选择字段导出范围：")]),e._v(" "),a("div",{staticClass:"field-list"},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),e._v(" "),a("el-checkbox-group",{on:{change:e.handleChange},model:{value:e.selectionList,callback:function(t){e.selectionList=t},expression:"selectionList"}},e._l(e.fieldList,(function(t,i){return a("el-checkbox",{key:i,attrs:{label:t.sortId}},[e._v(e._s(t.label))])})))],1),e._v(" "),a("div",{staticClass:"select-num"},[e._v("已选择"+e._s(e.selectionList.length)+"项")])]),e._v(" "),a("div",{staticClass:"fileType"},[a("div",{staticClass:"title"},[e._v("选择导出文件类型")]),e._v(" "),a("el-radio-group",{model:{value:e.fileType,callback:function(t){e.fileType=t},expression:"fileType"}},[a("el-radio",{attrs:{label:1}},[e._v("xls")]),e._v(" "),a("el-radio",{attrs:{label:2}},[e._v("csv")])],1)],1)],1),e._v(" "),e.exportLoading?a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.exportLoading,expression:"exportLoading"}],staticClass:"step-section",attrs:{"element-loading-text":"正在导出中","element-loading-spinner":"el-icon-loading"}}):e._e(),e._v(" "),2==e.stepsActive?a("div",{staticClass:"step-section"},[a("div",{staticClass:"success"},[a("img",{attrs:{src:i("d284")}}),e._v(" "),a("div",[e._v("导出完成")])])]):e._e()],1),e._v(" "),e.exportLoading?e._e():a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[1==e.stepsActive?a("el-button",{attrs:{type:"primary"},on:{click:e.sureClick}},[e._v("立即导出")]):a("el-button",{attrs:{type:"primary"},on:{click:e.closeView}},[e._v("确认")]),e._v(" "),a("el-button",{on:{click:e.closeView}},[e._v("取消")])],1)])],1)},pe=[],ve=(i("841c"),i("f550")),ge={name:"WkExport",props:{moduleObj:Object,sceneId:[String,Number],searchKeyword:String,showExport:Boolean,isAllExport:Boolean,selectedList:Array},data:function(){return{loading:!1,fieldList:[],selectionList:[],fileType:1,stepsActive:1,checkAll:!1,isIndeterminate:!1,exportLoading:!1}},mounted:function(){this.getFieldList()},methods:{sureClick:function(){var e=this;if(0!=this.selectionList.length){this.exportLoading=!0;var t={sortIds:this.selectionList,isXls:this.fileType,moduleId:this.moduleObj.moduleId,version:this.moduleObj.version,categoryId:this.moduleObj.categoryId};this.isAllExport?t.search={moduleId:this.moduleObj.moduleId,sceneId:this.sceneId,search:this.searchKeyword}:t.ids=this.selectedList.map((function(e){return e.dataId}));var i=this.isAllExport?ve["a"]:ve["b"];i(t).then((function(t){Object(Q["c"])(t),e.exportLoading=!1,e.stepsActive=2})).catch((function(){e.exportLoading=!1}))}else this.$message.error("请选择字段导出范围")},getFieldList:function(){var e=this;this.loading=!0;var t={moduleId:this.moduleObj.moduleId,version:this.moduleObj.version};Object(p["b"])(t).then((function(t){t.data=t.data.filter((function(e){return!e.hasOwnProperty("formType")||e.formType&&!["handwriting_sign","desc_text","field_group"].includes(e.formType)&&!["status","currentFlowId","flowStatus","categoryId"].includes(e.fieldName)}));for(var i=[],a=[],n=0;n<t.data.length;n++){var s=t.data[n],l=0;l=s.width?s.width:s.name&&s.name.length<=6?15*s.name.length+45:140,i.push({prop:s.fieldName,formType:s.formType,label:s.name,width:l,sortId:s.fieldId}),a.push(s.fieldId)}e.fieldList=i,e.selectionList=a,e.checkAll=!0,e.loading=!1})).catch((function(){e.loading=!1}))},handleSelectionChange:function(e){this.selectionList=e},closeView:function(){this.exportLoading||(this.$emit("close"),this.stepsActive=1,this.selectionList=[])},handleCheckAllChange:function(e){this.selectionList=e?this.fieldList.map((function(e){return e.sortId})):[],this.isIndeterminate=!1},handleChange:function(e){var t=e.length;this.checkAll=t===this.fieldList.length,this.isIndeterminate=t>0&&t<this.fieldList.length}}},be=ge,ye=(i("211d"),Object(C["a"])(be,me,pe,!1,null,"30baa225",null)),ke=ye.exports,_e=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{attrs:{visible:e.showImport,"append-to-body":!0,"close-on-click-modal":!1,width:"750px"},on:{close:e.closeView}},[i("span",{staticClass:"el-dialog__title",attrs:{slot:"title"},slot:"title"},[e._v("\n      导入"+e._s(e.moduleObj.name)+"\n    ")]),e._v(" "),i("div",{staticClass:"dialog-body"},[i("el-steps",{attrs:{active:e.stepsActive,simple:""}},e._l(e.stepList,(function(e,t){return i("el-step",{key:t,attrs:{title:e.title,icon:e.icon,status:e.status}})}))),e._v(" "),1==e.stepsActive?i("div",{staticClass:"step-section"},[i("div",{staticClass:"sections"},[i("div",{staticClass:"sections__title"},[e._v("一、请按照数据模板的格式准备要导入的数据。"),i("span",{staticClass:"download",on:{click:e.download}},[e._v("点击下载《"+e._s(e.moduleObj.name)+"导入模板》")])]),e._v(" "),i("div",{staticClass:"sections__tips"},[e._v("导入文件请勿超过2MB（约10,000条数据）")]),e._v(" "),i("div",{staticClass:"sections__tips"},[e._v("导入的数据将不触发工作流程")])]),e._v(" "),e.config.repeatHandleShow?i("div",{staticClass:"sections"},[i("div",{staticClass:"sections__title"},[e._v("二、请选择数据重复时的处理方式")]),e._v(" "),e.config.repeatRuleShow?i("div",{staticClass:"sections__tips"},[e._v("查重规则为：添加"+e._s(e.moduleObj.name)+"时所需填写的所有唯一字段，当前设置唯一字段为："+e._s(e.fieldUniqueInfo))]):e._e(),e._v(" "),i("div",{staticClass:"content"},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.repeatHandling,callback:function(t){e.repeatHandling=t},expression:"repeatHandling"}},e._l([{name:"覆盖系统原有数据",value:1},{name:"跳过",value:2}],(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.value}})})))],1)]):e._e(),e._v(" "),i("div",{staticClass:"sections"},[i("div",{staticClass:"sections__title"},[e._v(e._s(e.config.repeatHandleShow?"三":"二")+"、请选择需要导入的文件")]),e._v(" "),i("div",{staticClass:"content"},[i("flexbox",{staticClass:"file-select"},[i("el-input",{attrs:{disabled:!0},model:{value:e.file.name,callback:function(t){e.$set(e.file,"name",t)},expression:"file.name"}}),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.selectFile}},[e._v("选择文件")])],1)],1)]),e._v(" "),e.config.ownerSelectShow?i("div",{staticClass:"sections"},[i("div",{staticClass:"sections__title"},[e._v("四、请选择负责人（负责人为必填字段，若不填写，则会导致导入失败）")]),e._v(" "),i("div",{staticClass:"content"},[i("div",{staticClass:"user-cell"},[i("wk-user-dialog-select",{staticStyle:{width:"100%"},attrs:{radio:""},on:{change:e.getFirstStepStatus},model:{value:e.user,callback:function(t){e.user=t},expression:"user"}})],1)])]):e._e()]):2==e.stepsActive?i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"step-section",attrs:{"element-loading-text":e.importLoadingText,"element-loading-spinner":"el-icon-loading"}},[i("div",{staticClass:"step-section__tips"},[e._v("当前数据正在导入，您可以点击【最小化】隐藏该页面，数据导入不受影响。")])]):3==e.stepsActive?i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"step-section"},[i("div",{staticClass:"result-info"},[i("i",{staticClass:"wk wk-success result-info__icon"}),e._v(" "),i("p",{staticClass:"result-info__des"},[e._v("数据导入完成")]),e._v(" "),e.resultData?i("p",{staticClass:"result-info__detail"},[e._v(e._s(e.resultData.value))]):e._e(),e._v(" "),e.resultData&&e.resultData.extData>0?i("el-button",{staticClass:"result-info__btn--err",staticStyle:{padding:"0"},attrs:{type:"primary-text"},on:{click:function(t){e.downloadErrData(e.resultData)}}},[e._v("下载错误数据")]):e._e()],1)]):e._e(),e._v(" "),i("input",{attrs:{id:"import-input-file",type:"file"},on:{change:e.uploadFile}})],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.config.historyShow?i("el-popover",{attrs:{placement:"top",width:"800","popper-class":"no-padding-popover",trigger:"click"},model:{value:e.historyPopoverShow,callback:function(t){e.historyPopoverShow=t},expression:"historyPopoverShow"}},[i("import-history",{attrs:{show:e.historyPopoverShow,"module-obj":e.moduleObj},on:{close:function(t){e.historyPopoverShow=!1}}}),e._v(" "),i("el-button",{staticClass:"history-btn",attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("查看历史导入记录")])],1):e._e(),e._v(" "),e.sureTitle?i("el-button",{attrs:{type:"primary"},on:{click:e.sureClick}},[e._v(e._s(e.sureTitle))]):e._e(),e._v(" "),i("el-button",{class:{"is-hidden":!e.showCancel},on:{click:e.closeView}},[e._v("取消")])],1)]),e._v(" "),e.showFixImport?i("xr-import",{attrs:{"process-status":e.importStatus},nativeOn:{click:function(t){return e.fixImportClick(t)}}}):e._e()],1)},we=[],xe=i("e170"),Ie=i("8f81"),Ce=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"import-history"},[i("div",{staticClass:"import-history__hd"},[i("span",{staticClass:"import-history__title"},[e._v("查看历史导入记录")]),e._v(" "),i("span",{staticClass:"import-history__des"},[e._v("(错误数据只保存七天,七天后将自动失效)")]),e._v(" "),i("el-button",{staticClass:"xr-icon-close-btn",attrs:{icon:"el-icon-close"},on:{click:e.closeClick}})],1),e._v(" "),i("el-table",{staticClass:"import-history__bd",staticStyle:{width:"100%"},attrs:{data:e.tableList,height:"350"}},[i("el-table-column",{attrs:{prop:"createTime",label:"导入时间",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.createTime)+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作人",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.createUserName)+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"address",label:"导入结果"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.value)+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"option",width:"150",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[Number(t.row.extData)>0?[1==t.row.valid?i("el-button",{staticStyle:{padding:"0"},attrs:{type:"primary-text"},on:{click:function(i){e.downloadError(t.row.messageId)}}},[e._v("下载错误数据")]):0==t.row.valid?i("span",{staticClass:"invalid-tips"},[e._v("已失效")]):e._e()]:e._e()]}}])})],1),e._v(" "),i("div",{staticClass:"import-history__ft"},[i("el-button",{attrs:{type:"primary"},on:{click:e.closeClick}},[e._v("关闭")])],1)],1)},Se=[],Oe={name:"ImportHistory",components:{},props:{show:{type:Boolean,default:!1},moduleObj:Object},data:function(){return{loading:!1,tableList:[]}},computed:{},watch:{show:function(e){e&&this.getList()}},mounted:function(){},beforeDestroy:function(){},methods:{getList:function(){var e=this;this.loading=!0,Object(ve["g"])({moduleId:this.moduleObj.moduleId,categoryId:this.moduleObj.categoryId,type:0}).then((function(t){e.loading=!1,e.tableList=t.data.list})).catch((function(){e.loading=!1}))},downloadError:function(e){Object(xe["a"])({messageId:e}).then((function(e){Object(Q["c"])(e)})).catch((function(){}))},closeClick:function(){this.$emit("close")}}},je=Oe,Te=(i("501a"),Object(C["a"])(je,Ce,Se,!1,null,"4b79a508",null)),Fe=Te.exports,Le=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("flexbox",{staticClass:"xr-import"},[e.loading?i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"xr-import__icon"}):i("i",{staticClass:"wk wk-success xr-import__icon"}),e._v(" "),i("p",{staticClass:"xr-import__label",class:{"is-loading":e.loading}},[e._v(e._s(e.processLabel))])])},Ne=[],De={name:"XrImport",components:{},props:{processStatus:{type:String,default:"wait"}},data:function(){return{}},computed:{loading:function(){return"process"==this.processStatus},processLabel:function(){return this.loading?"导入中":"导入完成"}},watch:{},mounted:function(){},beforeDestroy:function(){},methods:{}},$e=De,Ee=(i("d7c6"),Object(C["a"])($e,Le,Ne,!1,null,"0d79d170",null)),Ae=Ee.exports,Pe=i("e297"),Ve=i.n(Pe),Be=i("8ed6"),Re={data:function(){return{importStatus:"",cacheShow:!1,cacheDone:!1,userInfo:null}},created:function(){var e=Ve.a.get("moduleImportInfo");e&&e.messageId?(this.lockrSecondQueryNum(e.messageId),this.cacheShow=!0):this.cacheShow=!1},computed:{showFixImport:function(){return!this.showImport&&this.importStatus&&"wait"!=this.importStatus}},watch:{},methods:{importChange:function(e){this.importStatus=this.showImport&&"finish"==e?"":e},fixImportClick:function(){this.$emit("change")},importClose:function(e){"finish"==e&&(this.importStatus="")},lockrSecondQueryNum:function(e){var t=this;Object(xe["b"])({messageId:e}).then((function(e){null===e.data?(t.importStatus="finish",t.cacheDone=!0):(t.cacheDone=!1,t.importStatus="process")})).catch((function(){Ve.a.rm("moduleImportInfo")}))}}},He={ownerSelectShow:!1,historyShow:!0,repeatHandleShow:!0,repeatRuleShow:!0,importRequest:null,noImportProcess:!1,downloadErrFuc:null,userInfo:null},Me={name:"WkImport",components:{WkUserDialogSelect:Ie["a"],ImportHistory:Fe,XrImport:Ae},mixins:[Re],props:{showImport:Boolean,moduleObj:Object},data:function(){return{loading:!1,fieldList:[],repeatHandling:1,file:{name:""},user:"",stepsActive:1,stepList:[{icon:"wk wk-upload",title:"上传文件",status:"wait"},{icon:"wk wk-data-import",title:"导入数据",status:"wait"},{icon:"wk wk-success",title:"导入完成",status:"wait"}],resultData:null,processData:{count:0,status:""},messageId:null,intervalTimer:null,historyPopoverShow:!1}},computed:{importLoadingText:function(){return this.processData.count?"数据导入中（当前已导入".concat(this.processData.count,"条）"):"数据导入中"},sureTitle:function(){return{1:"立即导入",2:"最小化",3:"确定"}[this.stepsActive]},showCancel:function(){return 2!=this.stepsActive},fieldUniqueInfo:function(){var e=this.fieldList.filter((function(e){return 1==e.isUnique}));return e.map((function(e){return e.name})).join("/")||"无"},config:function(){return Object(Be["a"])(Object(o["a"])({},He),this.moduleProps||{})}},watch:{cacheShow:{handler:function(e){if(e){this.cacheShow=!1;var t=Ve.a.get("moduleImportInfo");t&&t.messageId&&(this.loading=!0,this.messageId=t.messageId,this.stepList[0].status="finish",this.cacheDone?(this.stepList[1].status="finish",this.stepsActive=3,this.thirdQueryResult()):(this.stepsActive=2,this.stepList[1].status="process"),this.loopSecondQueryNum())}},immediate:!0},showImport:{handler:function(e){e?1==this.stepsActive&&(this.config.userInfo&&(this.user=this.config.userInfo.userId),this.config.repeatRuleShow&&this.config.repeatHandleShow&&this.getField()):(3==this.stepsActive&&this.resetData(),this.fieldList=[])},immediate:!0},stepsActive:function(){this.importChange({1:"wait",2:"process",3:"finish"}[this.stepsActive])}},created:function(){},methods:{sureClick:function(){var e=this;1==this.stepsActive?"finish"==this.stepList[0].status?(this.stepList[1].status="process",this.stepsActive=2,this.firstUpdateFile((function(t){var i=t.data||{};e.config.noImportProcess?(e.loading=!1,e.stepList[1].status="finish",e.stepsActive=3,e.$emit("status","finish"),e.resultData=i,i.errSize>0?e.stepList[2].status="error":e.stepList[2].status="finish"):(e.messageId=i,Ve.a.set("moduleImportInfo",{messageId:e.messageId}),e.loopSecondQueryNum())}))):this.file.name?this.config.ownerSelectShow&&!this.user&&this.$message.error("请选择负责人"):this.$message.error("请选择导入文件"):this.closeView()},firstUpdateFile:function(e){var t=this,i={},a=new FormData,n={moduleId:this.moduleObj.moduleId,version:this.moduleObj.version,repeatHandling:this.repeatHandling};a.append("data",new Blob([JSON.stringify(n)],{type:"application/json"})),a.append("file",this.file),i.file=this.file;var s=ve["d"];this.loading=!0,s(a).then((function(t){e&&e(t)})).catch((function(){e&&e(!1),t.loading=!1}))},loopSecondQueryNum:function(){var e=this;this.secondQueryNum(),this.intervalTimer=setInterval((function(){"end"==e.processData.status?(clearInterval(e.intervalTimer),e.intervalTimer=null,e.thirdQueryResult()):e.secondQueryNum()}),2e3)},secondQueryNum:function(){var e=this;Object(ve["i"])({messageId:this.messageId}).then((function(t){null===t.data?e.processData.status="end":(e.processData.status="",e.processData.count=t.data)})).catch((function(){}))},thirdQueryResult:function(){var e=this;Object(ve["h"])({messageId:this.messageId}).then((function(t){e.loading=!1,e.stepList[1].status="finish",e.stepsActive=3,e.$emit("status","finish"),t&&(e.resultData=t.data,t.data.errSize>0?e.stepList[2].status="error":e.stepList[2].status="finish")})).catch((function(){}))},downloadErrData:function(e){var t=this;this.loading=!0,this.config.downloadErrFuc?this.config.downloadErrFuc(e).then((function(e){Object(Q["c"])(e),t.loading=!1})).catch((function(){t.loading=!1})):Object(xe["a"])({messageId:this.messageId}).then((function(e){Object(Q["c"])(e),t.loading=!1})).catch((function(){t.loading=!1}))},download:function(){var e={moduleId:this.moduleObj.moduleId,version:this.moduleObj.version,categoryId:this.moduleObj.categoryId};Object(ve["c"])(e).then((function(e){Object(Q["c"])(e)})).catch((function(){}))},selectFile:function(){document.getElementById("import-input-file").click()},uploadFile:function(e){var t=e.target.files,i=t[0];Object(Q["A"])(i.name)&&(this.file=i,this.getFirstStepStatus()),e.target.value=""},getFirstStepStatus:function(){var e=this.file&&this.file.size,t=!!this.user;this.config.ownerSelectShow?this.stepList[0].status=e&&t?"finish":"wait":this.stepList[0].status=e?"finish":"wait"},closeView:function(){3==this.stepsActive&&Ve.a.rm("moduleImportInfo"),this.$emit("close",3==this.stepsActive?"finish":""),this.importClose(3==this.stepsActive?"finish":"")},resetData:function(){this.repeatHandling=1,this.file={name:""},this.user="",this.stepsActive=1,this.stepList=[{icon:"wk wk-upload",title:"上传文件",status:"wait"},{icon:"wk wk-data-import",title:"导入数据",status:"wait"},{icon:"wk wk-success",title:"导入完成",status:"wait"}],this.resultData=null,this.processData={count:0,status:""},this.messageId=null},getField:function(){var e=this,t={moduleId:this.moduleObj.moduleId,version:this.moduleObj.version,categoryId:this.moduleObj.categoryId};Object(te["d"])(t).then((function(t){e.fieldList=t.data})).catch((function(){}))}}},Ue=Me,We=(i("1459"),Object(C["a"])(Ue,_e,we,!1,null,"e5143c7c",null)),ze=We.exports,qe=i("3835"),Ge=(i("c740"),i("0481"),i("4069"),i("00b4"),i("563d")),Qe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-popover",{staticClass:"field-set-wrap",attrs:{"popper-class":"no-padding-popover",placement:"bottom-end",width:"240",trigger:"click"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[i("div",{staticClass:"field-set"},[i("el-input",{staticClass:"field-set__search",attrs:{placeholder:"搜索字段（拖拽字段进行排序）"},on:{input:e.searchClick},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),i("div",{staticClass:"field-set__title"},[e._v("显示这些字段")]),e._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"field-set__content"},[e._l(e.disabledFields,(function(t,a){return i("flexbox",{key:a,staticClass:"field-set__content--item "},[i("el-checkbox",{model:{value:t.check,callback:function(i){e.$set(t,"check",i)},expression:"item.check"}},[t.center?i("span",[e._v(e._s(t.left)),i("span",{staticClass:"input-word"},[e._v(e._s(t.center))]),e._v(e._s(t.right))]):i("span",[e._v(e._s(t.name))])])],1)})),e._v(" "),i("draggable",{attrs:{options:{filter:".el-checkbox",handle:".drag-handle"}},model:{value:e.dragFields,callback:function(t){e.dragFields=t},expression:"dragFields"}},e._l(e.dragFields,(function(t,a){return i("flexbox",{key:a,staticClass:"field-set__content--item "},[i("el-checkbox",{model:{value:t.check,callback:function(i){e.$set(t,"check",i)},expression:"item.check"}},[t.center?i("span",[e._v(e._s(t.left)),i("span",{staticClass:"input-word"},[e._v(e._s(t.center))]),e._v(e._s(t.right))]):i("span",[e._v(e._s(t.name))])]),e._v(" "),i("div",{staticClass:"drag-handle"},[e._v("⋮⋮")])],1)})))],2),e._v(" "),i("div",{staticClass:"field-set__ft"},[i("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.save}},[e._v("保存")]),e._v(" "),i("el-button",{attrs:{size:"medium",type:"text"},on:{click:e.reSet}},[e._v("重置")])],1)],1),e._v(" "),e.$slots.reference?e._t("default",null,{slot:"reference"}):i("el-button",{staticClass:"set-btn",attrs:{slot:"reference",type:e.show?"selected":"",icon:"wk wk-icon-config-line"},on:{click:function(t){e.show=!e.show}},slot:"reference"})],2)},Ye=[],Je=i("2f62"),Ke={name:"FieldSet",components:{Draggable:ae.a},props:{moduleId:[String,Number],categoryId:[String,Number],version:[String,Number]},data:function(){return{loading:!1,show:!1,fields:[],disabledFields:[],dragFields:[],copyFields:[],search:""}},computed:Object(o["a"])({},Object(Je["c"])(["userInfo"])),watch:{show:function(e){e&&this.getList()}},mounted:function(){},beforeDestroy:function(){},methods:{getList:function(){var e=this;this.loading=!0;var t=[Object(p["c"])({moduleId:this.moduleId,categoryId:this.categoryId,version:this.version})];this.userInfo.isAdmin||t.push(Object(Ge["b"])({moduleId:this.moduleId,userId:this.userInfo.userId})),Promise.all(t).then((function(t){var i=Object(qe["a"])(t,2),a=i[0];a=void 0===a?{}:a;var n=a.data,s=i[1];s=void 0===s?{}:s;var l=s.data;e.loading=!1;var o=Object(R["a"])(n||[],{excludesFieldName:["categoryId","stageId","teamMember"],filterSys:!1,rules:function(e){if(e.groupId)return!1;var t=((l||[]).find((function(t){return t.fieldId===e.fieldId}))||{}).authLevel;return 1!==t&&!["detail_table","field_group"].includes(e.formType)}});o.forEach((function(e){e.left="",e.center="",e.right="",e.check=0===e.isHide})),e.fields=o,e.getShowFields(e.fields),e.copyFields=Object(Q["t"])(o)})).catch((function(){e.loading=!1}))},getShowFields:function(e){var t=!1,i=[],a=[];e.forEach((function(e){1!==e.isLock&&(t=!0),t?a.push(e):i.push(e)})),this.dragFields=a,this.disabledFields=i},searchClick:function(){var e=this;this.fields=this.fields.map((function(t){var i=t.name.indexOf(e.search);if(-1!=i){t.left=t.name.substr(0,i),t.center=t.name.substr(i,e.search.length);var a=i+e.search.length;t.right=t.name.substr(a,t.name.length-a)}else t.left="",t.center="",t.right="";return t}))},save:function(){var e=this,t=this.disabledFields.concat(this.dragFields),i=t.filter((function(e){return e.check}));if(i.length<2)this.$message.error("至少要显示两列");else{var a={moduleId:this.moduleId,categoryId:this.categoryId,hideFields:t.filter((function(e){return!e.check})),noHideFields:i};this.loading=!0,Object(te["o"])(a).then((function(){e.$message.success("操作成功"),e.loading=!0,e.show=!1,e.$emit("change")})).catch((function(){e.loading=!1}))}},reSet:function(){this.fields=Object(Q["t"])(this.copyFields),this.getShowFields(this.fields)}}},Xe=Ke,Ze=(i("8068"),Object(C["a"])(Xe,Qe,Ye,!1,null,"05b68d6f",null)),et=Ze.exports,tt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return!e.showPreview&&e.src?i("div",{staticClass:"adapter-image img-wrapper",on:{click:e.handleClick}},[i("img",{staticClass:"small-img",attrs:{src:e.dataSrc,alt:""}})]):e.showPreview&&e.src?i("div",{staticClass:"img-popover adapter-image"},[i("div",{staticClass:"img-wrapper img-core",on:{click:e.handleClick}},[i("img",{staticClass:"small-img",attrs:{src:e.dataSrc,alt:""}})]),e._v(" "),e.popoverFlag?i("el-popover",{attrs:{placement:"right",width:"200",trigger:"hover"},model:{value:e.popoverVisible,callback:function(t){e.popoverVisible=t},expression:"popoverVisible"}},[i("div",{staticClass:"middle-img img-wrapper",on:{click:function(t){return t.stopPropagation(),e.handleClick(t)}}},[e.popoverVisible?i("img",{staticClass:"middle-img-core",attrs:{src:e.dataSrc,alt:""}}):e._e()]),e._v(" "),i("div",{staticClass:"reference",attrs:{slot:"reference"},slot:"reference"})]):e._e()],1):i("div",{staticClass:"adapter-image img-wrapper",staticStyle:{"background-color":"unset"},on:{click:function(e){e.stopPropagation()}}})},it=[],at={name:"AdapterImage",props:{src:{type:String,default:""},showPreview:{type:Boolean,default:!1}},data:function(){return{popoverVisible:!1,popoverFlag:!0,backgroundStyle:{}}},computed:{dataSrc:function(){return this.src?Object({VUE_APP_BASE_API:"/",VUE_APP_LOCATION_ORIGIN:"https://www.72crm.com",VUE_APP_CALL_SOCKET:"wss://www.72crm.com/web_im?token=",VUE_APP_REGISTER_URL:"https://www.72crm.com/72crm/#/register/index",VUE_APP_HOME_URL:"https://www.72crm.com/72crm/#/",VUE_APP_MARKETING_FOLDER:"72marketing",VUE_APP_ID_CENTER_LOGIN_URL:"https://id.72crm.com/index.html",VUE_APP_CORRECT_DOMAIN:"1",VUE_APP_MAIN_DOMAIN:"https://www.72scrm.com",VUE_APP_SIDE_DOMAIN:"https://www.72scrm.com/scrm",VUE_APP_DOMAIN_IP:"101.200.44.152",VUE_APP_DOMAIN_IP2:"47.93.91.154",VUE_APP_DOMAIN_IP3:"101.200.200.69",NODE_ENV:"production",VUE_APP_CONTACT_URL:"https://www.72crm.com/contact",BASE_URL:""}).BASE_API+this.src:""}},methods:{handleClick:function(e){var t=this;this.popoverFlag=!1,this.popoverVisible=!1,this.$nextTick((function(){t.popoverFlag=!0})),this.$emit("click",e)}}},nt=at,st=(i("0c38"),Object(C["a"])(nt,tt,it,!1,null,"061fe8fe",null)),lt=st.exports,ot=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{visible:e.visible,"close-on-click-modal":!1,title:"高级筛选",width:"900px"},on:{"update:visible":function(t){e.visible=t},close:e.handleCancel}},[i("div",{staticStyle:{"margin-bottom":"10px"}},[e._v("筛选条件")]),e._v(" "),i("div",{staticClass:"filter-container",attrs:{id:"filter-container"}},e._l(e.form,(function(t,a){return i("el-row",{key:a,attrs:{gutter:15}},[i("el-col",{attrs:{span:7}},[i("el-select",{attrs:{placeholder:"请选择要筛选的字段名"},on:{change:function(i){e.fieldChange(t)}},model:{value:t.fieldName,callback:function(i){e.$set(t,"fieldName",i)},expression:"formItem.fieldName"}},e._l(e.fieldList,(function(e){return i("el-option",{key:e.fieldName,attrs:{label:e.name,value:e.fieldName}})})))],1),e._v(" "),e.showCalCondition(t.formType,t.fieldName)?i("el-col",{attrs:{span:5}},[i("el-select",{attrs:{placeholder:"请选择范围"},on:{change:function(i){e.selectChange(i,t)}},model:{value:t.condition,callback:function(i){e.$set(t,"condition",i)},expression:"formItem.condition"}},e._l(e.getConditionList(t.formType,t.fieldName),(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1):e._e(),e._v(" "),i("el-col",{staticStyle:{position:"relative"},attrs:{span:e.getValueSpan(t.formType,t.fieldName)}},[["isNull","isNotNull"].includes(t.condition)?[e._v("\n           \n        ")]:["flowStatus"===t.fieldName?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(e.flowStatusOptions,(function(e){return i("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}))):"flowType"===t.fieldName?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(e.flowTypeOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))):"stageStatus"===t.fieldName?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(e.stageStatusOptions,(function(e){return i("el-option",{key:e.key,attrs:{label:e.value,value:e.key}})}))):["select","checkbox"].includes(t.formType)?i("el-select",{attrs:{"value-key":"key",multiple:"",placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(t.optionsList,(function(e){return i("el-option",{key:e.key,attrs:{label:e.value,value:e}})}))):"field_attention"===t.formType?i("el-select",{attrs:{placeholder:"请选择筛选条件"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(e.typeOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))):["number","floatnumber","percent"].includes(t.formType)?[14===t.type?i("div",[i("el-input-number",{staticClass:"small",staticStyle:{width:"100px"},attrs:{controls:!1},model:{value:t.min,callback:function(i){e.$set(t,"min",i)},expression:"formItem.min"}}),e._v(" "),i("span",[e._v("-")]),e._v(" "),i("el-input-number",{staticClass:"small",staticStyle:{width:"100px"},attrs:{controls:!1},model:{value:t.max,callback:function(i){e.$set(t,"max",i)},expression:"formItem.max"}})],1):i("el-input-number",{staticClass:"small",attrs:{controls:!1},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}})]:"date"===t.formType||"datetime"===t.formType?[i("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:14===t.type,expression:"formItem.type === 14"}],ref:"wkDatePicker"+a,refInFor:!0,attrs:{"picker-options":e.getPickerOptions(t,a),type:e.getDateConfig(t).rangeType,"value-format":e.getDateConfig(t).format,"range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},on:{change:function(i){e.datePickerChange(t)}},model:{value:t.range,callback:function(i){e.$set(t,"range",i)},expression:"formItem.range"}}),e._v(" "),t.timeType?i("div",{staticClass:"date-range-content",on:{click:function(i){e.dateRangeSelect(t,a)}}},[e._v("\n              "+e._s(t.timeTypeName)+"\n            ")]):e._e(),e._v(" "),i("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:14!==t.type,expression:"formItem.type !== 14"}],attrs:{"value-format":e.getDateConfig(t).format,type:e.getDateConfig(t).type,placeholder:"选择日期"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}})]:"date_interval"===t.formType?i("el-date-picker",{staticStyle:{width:"100%","vertical-align":"middle"},attrs:{"value-format":t.dateValueFormat||"yyyy-MM-dd",clearable:"","start-placeholder":"开始日期","end-placeholder":"结束日期",type:"daterange"},on:{change:function(i){e.dateIntervalChange(t,a,i)}},model:{value:t.formValue,callback:function(i){e.$set(t,"formValue",i)},expression:"formItem.formValue"}}):"user"===t.formType||"single_user"===t.formType?i("wk-user-select",{attrs:{radio:!1},on:{change:function(i){e.userDepChange(t,arguments[0],arguments[1])}},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):"structure"===t.formType?i("wk-dep-select",{attrs:{radio:!1},on:{change:function(i){e.userDepChange(t,arguments[0],arguments[1])}},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):"boolean_value"===t.formType?i("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):"category"===t.formType?i("wk-product-category",{on:{change:function(i){e.productCategoryChange(i,t)}},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):"map_address"===t.formType?i("v-distpicker",{attrs:{province:t.address.state,city:t.address.city,area:t.address.area},on:{province:function(i){e.selectProvince(i,t)},city:function(i){e.selectCity(i,t)},area:function(i){e.selectArea(i,t)}}}):"position"===t.formType?i("wk-position",{attrs:{"show-detail":!1,"value-format":e.formatPosition,props:{checkStrictly:!0}},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):["field_tag"].includes(t.formType)?i("el-select",{attrs:{multiple:!0},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}},e._l(t.tagList,(function(e){return i("el-option",{key:e.key,attrs:{label:e.value,value:e}})}))):["data_union","data_union_multi"].includes(t.formType)?i("relevance-choose",{attrs:{"field-form":t,field:e.getFieldByFieldName(t.fieldName),"module-id":e.getUnionModuleId(t.fieldName),radio:!1,"use-last-verison":!1,"use-common":!0},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}}):i("el-input",{attrs:{placeholder:"多个条件请用；隔开"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"formItem.value"}})]],2),e._v(" "),i("el-col",{staticClass:"delete",attrs:{span:3}},[i("i",{staticClass:"wk wk-icon-refuse delete-btn",on:{click:function(t){e.handleDelete(a)}}}),e._v(" "),i("el-checkbox",{model:{value:t.checked,callback:function(i){e.$set(t,"checked",i)},expression:"formItem.checked"}},[e._v("外露")])],1)],1)}))),e._v(" "),i("p",{directives:[{name:"show",rawName:"v-show",value:e.showErrors,expression:"showErrors"}],staticClass:"el-icon-warning warning-info"},[i("span",{staticClass:"desc"},[e._v("筛选条件中有重复项！")])]),e._v(" "),i("el-button",{staticClass:"add-btn",attrs:{type:"text"},on:{click:function(t){e.handleAddRow(e.form)}}},[e._v("+ 添加筛选条件")]),e._v(" "),i("br"),e._v(" "),i("el-checkbox",{staticClass:"saveScene",model:{value:e.isSaveScene,callback:function(t){e.isSaveScene=t},expression:"isSaveScene"}},[e._v("保存为场景")]),e._v(" "),e.isSaveScene?i("el-input",{staticStyle:{width:"220px !important"},attrs:{type:"text",maxlength:"10",placeholder:"场景名称，最多10个字符"},model:{value:e.sceneName,callback:function(t){e.sceneName=t},expression:"sceneName"}}):e._e(),e._v(" "),i("br"),e._v(" "),e.isSaveScene?i("el-checkbox",{model:{value:e.isDefaultScene,callback:function(t){e.isDefaultScene=t},expression:"isDefaultScene"}},[e._v("\n    设置成默认\n  ")]):e._e(),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("确 定")]),e._v(" "),i("el-button",{on:{click:e.handleCancel}},[e._v("取 消")])],1)],1)},rt=[],ct=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-cascader",e._b({ref:"elCascader",staticStyle:{width:"100%"},attrs:{options:e.options,"show-all-levels":!1,props:e.defaultProps},on:{change:e.valueChange},model:{value:e.dataValue,callback:function(t){e.dataValue=t},expression:"dataValue"}},"el-cascader",e.$attrs,!1))},ut=[],dt=i("ea20"),ft={name:"ProductType",components:{},props:{item:Object,value:{type:[String,Number,Object,Array],default:null},type:{type:String,default:"jxc"}},data:function(){return{options:[],dataValue:null,defaultProps:{},request:null}},watch:{value:{handler:function(){this.value?this.dataValue&&this.dataValue.includes(this.value)||(this.dataValue=this.value):this.dataValue=null},deep:!0,immediate:!0}},mounted:function(){this.setConfig(),this.getProductCategoryIndex()},methods:{setConfig:function(){"crm"===this.type&&(this.defaultProps={children:"children",label:"label",value:"categoryId",checkStrictly:!0},this.request=dt["b"])},getProductCategoryIndex:function(){var e=this;this.request({type:"tree"}).then((function(t){e.options=e.formatOptions(t.data,e.defaultProps.children)})).catch((function(){}))},formatOptions:function(e,t){var i=this;return e.forEach((function(e){e.hasOwnProperty(t)&&(Object(H["b"])(e[t])?delete e[t]:e[t]=i.formatOptions(e[t],t))})),e},valueChange:function(e){this.$emit("input",e[e.length-1]||""),this.$emit("change",{valArr:e,value:e,item:this.item,valueContent:e.length>0?this.$refs.elCascader.getCheckedNodes()[0].label:""})}}},ht=ft,mt=Object(C["a"])(ht,ct,ut,!1,null,"3c11bab0",null),pt=mt.exports,vt={name:"FilterFormIndex",components:{WkUserSelect:$["a"],WkProductCategory:pt,VDistpicker:A["a"],WkDepSelect:E["a"],WkPosition:P["a"],RelevanceChoose:V["a"]},mixins:[G],props:{exposedFields:{type:Array,default:function(){return[]}},dialogVisible:{type:Boolean,required:!0,default:!1},fieldList:{type:Array,required:!0,default:function(){return[]}},obj:{type:Object,required:!0,default:function(){return{}}},moduleId:{type:String}},data:function(){return{form:[],visible:!1,showErrors:!1,saveDefault:!1,sceneName:"",isSaveScene:!1,isDefaultScene:!1,typeOptions:[{label:"一星",value:1},{label:"二星",value:2},{label:"三星",value:3},{label:"四星",value:4},{label:"五星",value:5}],formatPosition:R["d"],flowStatusOptions:R["c"],flowTypeOptions:M["a"].filter((function(e){return 0!==e.value})),stageStatusOptions:R["g"]}},computed:{},watch:{dialogVisible:{handler:function(e){var t=this;if(e){var i=Object(Q["t"])(this.obj.form);i=i.filter((function(e){return!!t.fieldList.find((function(t){return t.fieldName===e.fieldName}))})),this.form=i,this.form.length||this.handleAddRow(this.form),this.saveDefault=!1,this.sceneName=null}this.visible=this.dialogVisible},deep:!0,immediate:!0},form:{handler:function(e){this.$nextTick((function(){var e=document.getElementById("filter-container");e&&(e.scrollTop=e.scrollHeight)}))},deep:!0,immediate:!0}},methods:{getConditionList:function(e,t){var i=Object(R["i"])({formType:e,fieldName:t});return i||(i=this.getAdvancedFilterOptions(e,t)),i},getDateConfig:function(e){var t=this.getFieldByFieldName(e.fieldName);return["date","datetime"].includes(t.formType)?"datetime"===t.formType?Object(R["e"])(1):Object(R["e"])(t.precisions):{}},dateIntervalChange:function(e){Object(H["b"])(e.formValue)?e.value=null:e.value={fromDate:e.formValue[0],toDate:e.formValue[1]}},selectProvince:function(e,t){t.address.state=e.value},selectCity:function(e,t){t.address.city=e.value},selectArea:function(e,t){t.address.area=e.value},productCategoryChange:function(e,t){t.valueContent=e.valueContent},userDepChange:function(e,t,i){e.valueContent=i},selectChange:function(e,t){this.getConditionList(t.formType,t.fieldName).forEach((function(i){i.value===e&&(t.type=i.type)}))},showCalCondition:function(e,t){return this.getConditionList(e,t).length>0},getValueSpan:function(e,t){return this.showCalCondition(e,t)?9:14},getFieldByFieldName:function(e){var t=this.fieldList.find((function(t){return t.fieldName===e}));return t||{}},getUnionModuleId:function(e){var t=this.getFieldByFieldName(e);return t&&t.fieldUnionSaveBO&&t.fieldUnionSaveBO.targetModuleId?t.fieldUnionSaveBO.targetModuleId:null},fieldChange:function(e){var t=this.fieldList.find((function(t){return t.fieldName===e.fieldName}));t&&this.updateRowByField(e,t),this.getError()},handleCancel:function(){this.showErrors?this.showErrors=!1:this.$emit("changeObj",this.form),this.$emit("update:dialogVisible",!1)},getError:function(){this.showErrors=!1;for(var e=[],t=0;t<this.form.length;t++){var i=this.form[t];if(e.includes(i.fieldName)){this.showErrors=!0;break}e.push(i.fieldName)}},handleConfirm:function(){if(this.showErrors)this.$message.error("筛选条件中有重复项！");else if(!this.isSaveScene||this.sceneName){var e=this.checkFilterForm(this.form);if(e){var t={obj:this.getFilterForm(this.form),form:this.form,saveDefault:this.saveDefault,sceneName:this.sceneName};this.isSaveScene?this.requestCreateScene(t):this.$emit("filter",t)}}else this.$message.error("场景名称不能为空！")},requestCreateScene:function(e){var t=this;u({moduleId:this.moduleId,isDefault:this.isDefaultScene?1:0,name:this.sceneName,data:JSON.stringify(e.obj)}).then((function(i){t.$emit("save-success"),t.$emit("filter",e),t.$message({type:"success",message:"创建成功"})})).catch((function(){}))},handleDelete:function(e){var t=this;this.$confirm("您确定要删除这一条数据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.form.splice(e,1),t.getError()})).catch((function(){}))},getSettingValueType:function(e){if(e&&e.length>0){var t=e[0];return Object(F["a"])(t)}return[]},dateRangeSelect:function(e,t){var i=this.$refs["wkDatePicker".concat(t)][0];this.$nextTick((function(){i.focus(),i.pickerVisible=!0}))},datePickerChange:function(e){e.timeTypeName="",e.timeType=""},getPickerOptions:function(e,t){for(var i=this,a=[{text:"本年度",value:"year"},{text:"上一年度",value:"lastYear"},{text:"下一年度",value:"nextYear"},{text:"上半年",value:"firstHalfYear"},{text:"下半年",value:"nextHalfYear"},{text:"本季度",value:"quarter"},{text:"上一季度",value:"lastQuarter"},{text:"下一季度",value:"nextQuarter"},{text:"本月",value:"month"},{text:"上月",value:"lastMonth"},{text:"下月",value:"nextMonth"},{text:"本周",value:"week"},{text:"上周",value:"lastWeek"},{text:"下周",value:"nextWeek"},{text:"今天",value:"today"},{text:"昨天",value:"yesterday"},{text:"明天",value:"tomorrow"},{text:"过去7天",value:"previous7day"},{text:"过去30天",value:"previous30day"},{text:"未来7天",value:"future7day"},{text:"未来30天",value:"future30day"}],n=[],s=function(t){var s=a[t];n.push({text:s.text,onClick:function(t){t.$emit("pick",[],!1),i.$nextTick((function(){e.timeTypeName=s.text,e.timeType=s.value}))}})},l=0;l<a.length;l++)s(l);return{shortcuts:n}}}},gt=vt,bt=(i("da2d"),Object(C["a"])(gt,ot,rt,!1,null,"850f59ae",null)),yt=bt.exports,kt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wk-empty"},[i("div",{staticClass:"wk-empty__title"},[e._v(e._s(e.config.emptyText||"暂无数据"))]),e._v(" "),e.config.showButton?i("el-button",{staticStyle:{"margin-top":"8px"},attrs:{icon:e.config.buttonIcon,type:"primary"},on:{click:e.btnClick}},[e._v(e._s(e.config.buttonTitle||"新建"))]):e._e()],1)},_t=[],wt={emptyText:"",showButton:!1,buttonIcon:"",buttonTitle:""},xt={name:"WkEmpty",components:{},props:{props:Object},data:function(){return{}},computed:{config:function(){return Object(Be["a"])(Object(o["a"])({},wt),this.props||{})}},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{btnClick:function(){this.$emit("click")}}},It=xt,Ct=(i("ce52"),Object(C["a"])(It,kt,_t,!1,null,null,null)),St=Ct.exports,Ot=i("15cc"),jt=i("5c96"),Tt=i("18b2"),Ft={components:{FieldsSet:et,AdapterImage:lt,WkFieldView:v["default"],FilterForm:yt,WkEmpty:St},mixins:[w["a"]],data:function(){return{loading:!1,currentPage:1,pageSizes:[15,30,60,100],pageSize:Ve.a.get("pageSizes")||15,total:0,tableHeight:200,rowHeight:44,dataList:[],fieldList:[],otherParams:{},optionsList:[],selectedList:[],controlBtnGroup:[],clickedRow:null,showDetail:!1,showCreate:!1,showTransfer:!1,styleTimer:null,customConfig:{},tableStyleObj:{stripe:!0,bottomBorderShow:!0,rightBorderShow:!0},filterObj:{form:[]},showFilter:!1,filterFieldsLib:[]}},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(Je["c"])("appModule",["userAppCategoryList"])),Object(Je["c"])(["userInfo"])),{},{tableKey:function(){return"".concat(this.tableHeight||"0","-").concat(this.pageSize)},crmTableClass:function(){var e=[];return this.config&&this.config.radio&&e.push("no-all-selection"),this.tableStyleObj&&!1===this.tableStyleObj.rightBorderShow&&e.push("is-no-right-border-style"),this.tableStyleObj&&!1===this.tableStyleObj.bottomBorderShow&&e.push("is-no-bottom-border-style"),e.push("is-filter-table"),e.push("user-app-table"),e},canVisitFields:function(){return this.fieldList?this.fieldList.filter((function(e){return e.canVisit})).map((function(e){return e.fieldName||e.field||e.prop})):[]},canSave:function(){return!0},canExport:function(){return!0}}),watch:{controlBtnGroup:{handler:function(){var e=this;if(this.controlBtnGroup&&this.controlBtnGroup.length){var t=["transfer","delete","export","moveCategory"];t.forEach((function(t){var i=e.controlBtnGroup.findIndex((function(e){return e.value===t}));if(-1!==i){var a=e.moduleObj,n="".concat(a.moduleId,"-").concat(e.categoryId||""),s=e.$auth("".concat(a.applicationId,".").concat(n,".").concat(t));s||e.controlBtnGroup.splice(i,1)}}))}},deep:!0}},mounted:function(){window.addEventListener("resize",this.updateTableHeight)},beforeDestroy:function(){this.styleTimer&&clearTimeout(this.styleTimer),this.styleTimer=null,window.removeEventListener("resize",this.updateTableHeight)},methods:{getControlBtn:function(){var e=this,t=[{name:"转移",value:"transfer",icon:"wk wk-icon-transfer2"},{name:"删除",value:"delete",icon:"wk wk-icon-delete-line"},{name:"选中导出",value:"export",icon:"wk wk-icon-export2"}],i=this.$route.meta;if(i.categoryId){var a=this.userAppCategoryList.filter((function(t){return t.moduleId===e.moduleId&&t.version===e.moduleObj.version}));a.length>1&&t.push({name:"移动到分类",value:"moveCategory",icon:this.moduleObj.icon}),this.controlBtnGroup=t}else this.controlBtnGroup=t},getDataList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.loading)if(!i&&this.fieldList.length||(this.currentPage=1),t&&(this.otherParams=Object(o["a"])(Object(o["a"])({},this.otherParams),t)),this.loading=!0,i||!this.fieldList.length){this.dataList=[];var a=[Object(p["c"])({moduleId:this.moduleId,categoryId:this.categoryId,version:this.moduleObj.version}),Object(te["f"])({moduleId:this.moduleObj.moduleId,version:this.moduleObj.version})];this.userInfo.isAdmin||a.push(Object(Ge["b"])({moduleId:this.moduleId,userId:this.userInfo.userId})),Promise.all(a).then((function(t){var i=Object(qe["a"])(t,3),a=i[0];a=void 0===a?{}:a;var n=a.data,s=i[1];s=void 0===s?{}:s;var l=s.data,o=i[2];o=void 0===o?{}:o;var r=o.data;n=Object(R["a"])(n||[],{excludesFieldName:["categoryId","stageId","teamMember"],filterSys:!1,rules:function(e){return 0===e.isHide&&!e.groupId&&!["detail_table","field_group"].includes(e.formType)}}).map((function(e){return e.prop=e.fieldName,e.isLock=Boolean(e.isLock),e})).filter((function(e){var t=((r||[]).find((function(t){return t.fieldId===e.fieldId}))||{}).authLevel;return 1!==t}));var c=145,u=document.body.clientWidth-80,d=n.map((function(e){return e.width||c})).reduce((function(e,t){return e+t}));d>u-2&&n.forEach((function(e){e.width||(e.width=c)})),l.forEach((function(e){var t=n.find((function(t){return t.fieldId===e.relateFieldId}));t&&(t.fieldUnionSaveBO=e)})),e.fieldList=n,e._getData(e.otherParams)})).catch((function(){e.loading=!1}))}else this._getData(this.otherParams)},_getData:function(e){var t=this;this.loading=!0;var i=Object(o["a"])({page:this.currentPage,limit:this.pageSize,moduleId:this.moduleId},e);i.searchList||(i.searchList=[]),i.searchList.push({fieldName:"categoryId",formType:"text",type:this.categoryId?1:5,values:this.categoryId?[this.categoryId]:[]}),Object(p["d"])(i).then(function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=3,t.getDataUnionValueValue(i.data.list||[],t.fieldList);case 3:t.dataList=e.sent,t.total=Number(i.data.totalRow),t.loading=!1,t.$nextTick((function(){document.querySelector(".el-table__body-wrapper").scrollTop=1})),t.updateTableHeight();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(){t.loading=!1}))},handleRowClick:function(e,t){var i=this;"selection"!==t.type&&(this.showDetail=!1,this.$nextTick((function(){t.property===i.mainField.fieldName&&(i.clickedRow=e,i.rowID=e.dataId,i.showDetail=!0)})))},fieldFormatter:function(e,t,i,a){var n="--",s=e[t.property];if("handwriting_sign"===a.formType)return s;if("flowType"===t.property){if(!e.currentFlow)return n;var l=Number(e.currentFlow.flowType),o=M["a"].find((function(e){return e.value===l}));return o?o.label:n}if("stageStatus"===t.property){var r=Number(e.stageStatus),c=R["g"].find((function(e){return e.key===r}));return c?c.value:n}var u="data_union_multi"===a.formType;if(""===s||null===s||void 0===s)return{website:"",field_tag:[]}[a.formType]||(u?"":n);if("flowStatus"===t.property){if(!e.currentFlow)return n;var d=R["c"].find((function(e){return e.key===s}));return d?d.value:n}if("currentFlowId"===t.property)return e.currentFlow?e.currentFlow.flowName:e.currentFlowId;var f=Object(Ot["b"])(a.formType,s,a);return 0===f?f:f||n},getDataUnionValueValue:function(e,t){var i=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var n,s,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=regeneratorRuntime.mark((function a(n){var s,l,o,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s=t[n],["data_union","data_union_multi"].includes(s.formType)){a.next=3;break}return a.abrupt("return","continue");case 3:return s.canVisit=!0,a.next=6,i.asyncGetModuleObjById(s.fieldUnionSaveBO.targetModuleId);case 6:if(l=a.sent,l&&l.relateModuleId){a.next=10;break}return a.abrupt("return","continue");case 10:return s.canVisit=!1,o=e.map((function(e){return e[s.fieldName]})).filter((function(e){return!!e})).map((function(e){return e.split(",")})).flat(),a.next=14,Object(Tt["a"])(i.moduleId,s.fieldId,o).catch((function(){}));case 14:r=a.sent,e.forEach((function(e){if(!Object(H["b"])(e[s.fieldName])){var t=e[s.fieldName].split(",");e[s.fieldName]={fieldData:t.map((function(e){return r[e]})),module:l,values:t}}}));case 17:case"end":return a.stop()}}),a)})),s=0;case 3:if(!(s<t.length)){a.next=11;break}return a.delegateYield(n(s),"t0",5);case 5:if(l=a.t0,"continue"!==l){a.next=8;break}return a.abrupt("continue",8);case 8:s++,a.next=3;break;case 11:return a.abrupt("return",e);case 13:case"end":return a.stop()}}),a)})))()},handleSelectionChange:function(e){this.selectedList=e},handleSort:function(e){var t=e.prop,i=e.order;i?(this.otherParams.sortField=t,this.otherParams.order="descending"===i?1:2):(delete this.otherParams.sortField,delete this.otherParams.order),this.getDataList(this.otherParams)},handleDragend:function(e,t,i){var a=this;this.styleTimer&&(clearTimeout(this.styleTimer),this.styleTimer=null);var n=this.fieldList.find((function(e){return e.fieldName===i.property}));n&&(this.styleTimer=setTimeout((function(){Object(p["f"])({fieldId:n.fieldId,moduleId:a.moduleId,style:e}),clearTimeout(a.styleTimer),a.styleTimer=null}),500))},getFilterFieldInfo:function(){var e=this,t={moduleId:this.moduleId,categoryId:this.categoryId,version:this.moduleObj.version};Object(te["d"])(t).then((function(i){var a=Object(R["a"])(i.data||[],{filterSys:!1,excludesFieldName:!0,rules:function(e){return!e.groupId&&"detail_table"!==e.formType&&!e.isHidden&&!["file","handwriting_sign","desc_text","detail_table","statistic","field_group"].includes(e.formType)}});Object(te["f"])(t).then((function(t){var i=t.data||[];a.forEach((function(e){["data_union","data_union_multi"].includes(e.formType)&&(e.fieldUnionSaveBO=i.find((function(t){return t.relateFieldId===e.fieldId})))})),e.filterFieldsLib=a})).catch((function(){e.filterFieldsLib=a}))})).catch((function(){}))},handleSearch:function(){var e=this;this.otherParams.searchList||(this.otherParams.searchList=[]);var t=this.otherParams.searchList.findIndex((function(t){return t.fieldName===e.mainField.fieldName})),i={fieldName:this.mainField.fieldName,formType:this.mainField.formType,type:3,values:[this.searchKeyword]};-1!==t?this.otherParams.searchList[t]=i:this.otherParams.searchList.push(i),this.currentPage=1,this.getDataList(this.otherParams)},changeFilterObj:function(e){this.filterObj.form=e.filter((function(e){return e.name}))},handleFilter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.filterObj=e,this.currentPage=1,e.obj.length>0?this.otherParams.searchList=e.obj:delete this.otherParams.searchList,this.showFilter=!1,this.updateExposedField&&this.updateExposedField(),this.updateTableHeight(),this.getDataList(this.otherParams)},previewImage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=[],a=e.column.property;if(!Object(H["b"])(e.row[a])){var n=null===t?e.row[a].url:e.row[a][t].url;this.dataList.forEach((function(e,t){e[a]instanceof Array?i=i.concat(e[a]):i.push(e[a])})),i=i.filter((function(e){return!!e}));var s=i.findIndex((function(e){return e.url===n}));this.$wkPreviewFile.preview({index:s,data:i})}},handleSizeChange:function(e){Ve.a.set("pageSizes",e),this.pageSize=e,this.currentPage=1,this.getDataList(this.otherParams)},handleCurrentChange:function(e){this.currentPage=e,this.getDataList(this.otherParams)},cellClassName:function(e){e.row;var t=e.column;e.rowIndex,e.columnIndex;return this.canVisitFields.includes(t.property)?"can-visit--underline":""},updateTableHeight:function(){var e,t=this,i=document.documentElement.clientHeight;this.config&&this.config.otherHeight?this.$nextTick((function(){var a=t.getTableHeadHeight();t.tableHeight=i-t.config.otherHeight-a,e=t.getElTable(),e&&e.doLayout()})):this.$nextTick((function(){var a=t.getTableHeadHeight(),n=i-a-180;e=t.getElTable();var s=(e||{}).$el,l=3;if(s){var o=s.getElementsByClassName("el-table__body-wrapper")[0];/is-scrolling-/.test(o.className)&&-1===o.className.indexOf("is-scrolling-none")&&(l=13)}var r=t.rowHeight*t.dataList.length+39+l;t.tableHeight=r>n?n:0===t.dataList.length?200:r,e=t.getElTable(),e&&e.doLayout()}))},getTableHeadHeight:function(){var e=this.getChildInstance("UserAppHeader"),t=this.getChildInstance("FilterExposedFields"),i=e?e.$el.clientHeight:0,a=t?t.$el.clientHeight:0;return i+a},getChildInstance:function(e){var t=null;return this.$children.forEach((function(i){i.$options&&i.$options.name===e&&(t=i)})),t},getElTable:function(){var e=this.$refs.elTable;return Object(H["a"])(e)?e[e.length-1]:e},handleToggleExposed:function(){this.showFilterExposedBtn=!this.showFilterExposedBtn,this.updateCustomConfig()},getCustomConfig:function(){},updateCustomConfig:function(){this.customConfig.tableStyleObj=this.tableStyleObj,this.customConfig.filterConfig={showExportFields:this.showFilterExposedBtn}},handleRefresh:function(e){this.getDataList(this.otherParams,!0)},allExportExcel:function(e){var t=e||p["a"],i=jt["Loading"].service({fullscreen:!0,text:"导出中..."}),a=this.otherParams;this.moduleId&&(a=Object(o["a"])(Object(o["a"])({},this.otherParams),{},{moduleId:this.moduleId})),t(a).then((function(e){Object(Q["c"])(e),i.close()})).catch((function(){i.close()}))},fieldFixed:function(e){e.isLock=!e.isLock,Object(p["f"])({fieldId:e.fieldId,moduleId:this.moduleId,isLock:e.isLock?1:0})}}},Lt=i("a172"),Nt={name:"UserAppIndex",components:{ModuleCreate:b["a"],ModuleDetail:y["default"],UserAppHeader:O,SceneSet:he,TagView:g["a"],FilterExposedFields:X,WkFieldView:v["default"],ModuleExport:ke,ModuleImport:ze},mixins:[Ft,Lt["a"],w["a"],G],data:function(){return{searchKeyword:"",applicationId:null,moduleId:null,categoryId:null,moreTypes:[],showCreate:!1,createAction:{type:"save",id:"",title:"",data:{}},showDetail:!1,rowID:"",rowIndex:0,isDataList:!1,dataListAll:[],showSceneSet:!1,showFilterExposedBtn:!0,sceneList:[],exposedFields:[],showExport:!1,isAllExport:!0,showImport:!1}},computed:{moduleObj:function(){return this.getModuleObjByCategory(this.moduleId,{categoryId:this.categoryId})||{}},mainFieldId:function(){return this.moduleObj.mainFieldId},mainField:function(){var e=this;return Object(H["b"])(this.moduleObj)||0===this.fieldList.length?{}:this.fieldList.find((function(t){return t.fieldId===e.moduleObj.mainFieldId}))||{}},canSave:function(){if(!this.moduleObj)return!1;var e="".concat(this.moduleObj.moduleId,"-").concat(this.categoryId||"");return this.$auth("".concat(this.moduleObj.applicationId,".").concat(e,".save"))},indexAuth:function(){if(!this.moduleObj)return!1;var e="".concat(this.moduleObj.moduleId,"-").concat(this.categoryId||"");return this.$auth("".concat(this.moduleObj.applicationId,".").concat(e,".index"))},showFilterExposedFields:function(){return this.exposedFields.length>0},exportBtn:function(){return this.showFilterExposedBtn?{name:"收起筛选",class:"el-icon-arrow-up"}:{name:"展开筛选",class:"el-icon-arrow-down"}}},watch:{$route:{handler:function(){this.initCom()},deep:!0,immediate:!0},filterFieldsLib:{handler:function(){this.setDefaultExposedField()},deep:!0,immediate:!0}},methods:Object(o["a"])(Object(o["a"])({},Object(Je["b"])({getAllModuleListByAppId:"appModule/getAllModuleListByAppId"})),{},{initCom:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.applicationId=e.$route.meta.sourceApplicationId,t.next=4,e.getAllModuleListByAppId(e.applicationId);case 4:e.moduleId=e.$route.meta.sourceModuleId,e.selectedList=[],e.fieldList=[],e.otherParams={},e.filterObj={form:[]},i=e.$route.meta.categoryType,a=e.$route.meta.categoryId,e.categoryId=0===i?null:a,e.indexAuth&&(e.getSceneList(),e.getFilterFieldInfo(),e.getExposedField(),e.getCustomConfig(),e.getControlBtn()),e.$nextTick((function(){var t=e.getElTable();t.clearSelection()}));case 14:case"end":return t.stop()}}),t)})))()},GetFilterFields:function(e){return Object(R["f"])(e)},getExposedField:function(){var e=this;Object(p["g"])({moduleId:this.moduleId}).then((function(t){var i=t.data||{};e.exposedFields=(i.data||"").split(",").filter((function(e){return!!e})),e.setDefaultExposedField()})).catch((function(){}))},setDefaultExposedField:function(){var e=this;if(this.filterFieldsLib.length&&this.exposedFields.length){var t=[];this.exposedFields.forEach((function(i){var a=e.filterFieldsLib.find((function(e){return e.fieldName===i}));a&&e.handleAddRow(t,a,!0)})),this.$set(this.filterObj,"form",t)}},updateExposedField:function(){var e=this,t=this.filterObj.form.filter((function(e){return e.checked})).map((function(e){return e.fieldName})),i=t.length===this.exposedFields.length;if(i){var a=Array.from(new Set([].concat(Object(s["a"])(t),Object(s["a"])(this.exposedFields))));i=a.length===t.length}i||Object(p["h"])({moduleId:this.moduleId,data:t.join(",")}).then((function(){e.exposedFields=t})).catch((function(){}))},getSceneList:function(){var e=this;c({moduleId:this.moduleId}).then((function(t){e.sceneList=(t.data||[]).filter((function(e){return 0==e.isHide}))})).catch((function(){}))},handleCommand:function(e){if(e){if("export"!==e)return{delete:this.handleDelete,transfer:this.handleTransfer,create:this.handleCreate,moveCategory:this.handleMoveCategory}[e](this.selectedList.map((function(e){return e.dataId})),this.moduleObj.version);this.handleToExport(!1)}},cellClassName:function(e){var t=e.column;return t.property===this.mainField.fieldName?"can-visit--underline":""},updateList:function(){var e=this.getElTable();e.clearSelection(),this.getDataList({},!0),this.selectedList=[]},filterHeaderHandle:function(e,t){switch(e){case"scene":this.currentPage=1,this.getDataList({sceneId:t});break;case"sceneSet":this.showSceneSet=!0;break}},showFilterClick:function(e){var t=this.filterObj.form.find((function(t){return t.fieldName===e.fieldName}));if(!t){var i=this.filterFieldsLib.find((function(t){return t.fieldName===e.fieldName}));this.handleAddRow(this.filterObj.form,i)}this.showFilter=!0},clearFilterValue:function(){var e=this;this.filterObj.form.forEach((function(t){e.exposedFields.includes(t.fieldName)&&(["number","floatnumber","percent"].includes(t.formType)?(t.min="",t.max="",t.value=""):"map_address"===t.formType?t.address={state:"",city:"",area:""}:Object(H["a"])(t.value)?t.value=[]:Object(H["c"])(t.value)?t.value={}:t.value="")}))},handleClick:function(e){var t=this;this.showDetail=!1,this.$nextTick((function(){t.rowID=e.dataId,t.clickedRow=e,t.showDetail=!0}))},handleToExport:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isAllExport=e,this.showExport=!0},handleToImport:function(){this.showImport=!0},closeImport:function(e){e&&this.updateList(),this.showImport=!1}})},Dt=Nt,$t=(i("c2ef"),Object(C["a"])(Dt,a,n,!1,null,"0414ac94",null));t["default"]=$t.exports},7423:function(e,t,i){e.exports={colorPrimary:"#0052CC",colorBlack:"#172B4D",colorSuccess:"#36B37E",colorWarning:"#FFAB00",colorDanger:"#FF5630",colorN40:"#DFE1E6",axisLineColor:"#DFE1E6",axisLabelFontWeight:"500"}},"759d":function(e,t,i){},8068:function(e,t,i){"use strict";i("759d")},8577:function(e,t,i){"use strict";i("ffb9")},adbd:function(e,t,i){"use strict";i("68f0")},b2d9:function(e,t,i){},ba5b:function(e,t,i){},c2ef:function(e,t,i){"use strict";i("64d6")},c337:function(e,t,i){},ce52:function(e,t,i){"use strict";i("ebc2")},d241:function(e,t,i){"use strict";i("6590")},d58c:function(e,t,i){"use strict";i("7423")},d7c6:function(e,t,i){"use strict";i("6f58")},da2d:function(e,t,i){"use strict";i("ebcb")},e1f6:function(e,t,i){},ebc2:function(e,t,i){e.exports={colorPrimary:"#0052CC",colorBlack:"#172B4D",colorSuccess:"#36B37E",colorWarning:"#FFAB00",colorDanger:"#FF5630",colorN40:"#DFE1E6",axisLineColor:"#DFE1E6",axisLabelFontWeight:"500"}},ebcb:function(e,t,i){},ffb9:function(e,t,i){}}]);